<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultra-Premium Satsang Donation Management System</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Mukta:wght@400;700;800&family=Poppins:wght@400;600&display=swap" rel="stylesheet">

    <style>
        /* CSS ARCHITECTURE 
           Total design control for 4:6 Aspect Ratio
        */
        :root {
            --saffron: #FF9933;
            --gold-gradient: linear-gradient(45deg, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c);
            --deep-maroon: #380000;
            --glass-bg: rgba(255, 255, 255, 0.03);
            --neon-glow: 0 0 20px rgba(255, 153, 51, 0.5);
            --transition-speed: 0.8s;
        }

        * { box-sizing: border-box; -webkit-font-smoothing: antialiased; }

        body {
            margin: 0; padding: 0;
            background-color: #050505; /* For testing, will be transparent in OBS */
            font-family: 'Mukta', sans-serif;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* --- THE 4:6 MASTER OVERLAY (450px x 675px approx) --- */
        .overlay-container {
            width: 450px;
            height: 900px;
            background: linear-gradient(135deg, #200000 0%, #4a0404 50%, #200000 100%);
            border-left: 6px solid #bf953f;
            position: relative;
            overflow: hidden;
            box-shadow: -15px 0 45px rgba(0,0,0,0.9);
            z-index: 10;
        }

        /* The Live Moving Glow Effect (Left to Right Sweep) */
        .overlay-container::before {
            content: '';
            position: absolute;
            top: 0; left: -150%;
            width: 100%; height: 100%;
            background: linear-gradient(
                90deg, 
                transparent, 
                rgba(255, 255, 255, 0.05), 
                rgba(255, 255, 255, 0.1), 
                rgba(255, 255, 255, 0.05), 
                transparent
            );
            transform: skewX(-20deg);
            animation: liveSweep 6s infinite ease-in-out;
            z-index: 1;
            pointer-events: none;
        }

        @keyframes liveSweep {
            0% { left: -150%; }
            50% { left: 150%; }
            100% { left: 150%; }
        }

        /* Decorative Background Pattern */
        .bg-pattern {
            position: absolute; inset: 0;
            background-image: radial-gradient(var(--saffron) 1px, transparent 1px);
            background-size: 30px 30px;
            opacity: 0.05;
            z-index: 0;
        }

        /* --- PREMIUM HEADLINE DESIGN --- */
        .header-section {
            position: relative;
            z-index: 5;
            padding: 40px 20px;
            text-align: center;
            background: rgba(0,0,0,0.3);
            border-bottom: 2px solid var(--gold-gradient);
        }

        .main-title {
            font-size: 38px;
            font-weight: 800;
            background: var(--gold-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 0;
            line-height: 1.2;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));
            text-transform: uppercase;
        }

        .sub-title {
            font-size: 18px;
            color: var(--saffron);
            margin-top: 8px;
            font-weight: 600;
            letter-spacing: 1.5px;
            text-shadow: 0 0 10px rgba(255, 153, 51, 0.3);
        }

        /* --- DONOR LIST ANIMATION AREA --- */
        .list-viewport {
            padding: 20px;
            height: 750px;
            position: relative;
            z-index: 5;
        }

        .donor-page {
            display: flex;
            flex-direction: column;
            gap: 12px;
            transition: all var(--transition-speed) ease;
        }

        .donor-item {
            background: var(--glass-bg);
            border: 1px solid rgba(212, 175, 55, 0.15);
            border-radius: 12px;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            animation: slideInFade 0.6s ease forwards;
            backdrop-filter: blur(5px);
        }

        .donor-identity {
            display: flex; align-items: center; gap: 15px;
        }

        .donor-rank {
            width: 32px; height: 32px;
            background: var(--gold-gradient);
            border-radius: 50%;
            color: black;
            font-weight: 800;
            display: flex; align-items: center; justify-content: center;
            font-size: 16px;
            box-shadow: 0 0 10px rgba(179, 135, 40, 0.5);
        }

        .donor-name {
            font-size: 22px;
            font-weight: 700;
            color: #ffffff;
            text-shadow: 0 2px 4px rgba(0,0,0,0.8);
        }

        .donor-amount {
            font-size: 24px;
            font-weight: 800;
            color: var(--saffron);
            font-family: 'Poppins', sans-serif;
        }

        @keyframes slideInFade {
            from { opacity: 0; transform: translateX(40px); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* --- ADMIN PANEL: BROADCAST CONTROL CENTER --- */
        .admin-dashboard {
            width: 1000px;
            margin: 60px 0;
            background: #121212;
            border-radius: 24px;
            border: 1px solid #333;
            padding: 40px;
            box-shadow: 0 30px 60px rgba(0,0,0,0.5);
        }

        .admin-header {
            border-bottom: 2px solid #333;
            padding-bottom: 20px;
            margin-bottom: 30px;
            display: flex; justify-content: space-between; align-items: center;
        }

        .admin-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
        }

        .control-group {
            display: flex; flex-direction: column; gap: 15px;
        }

        label { color: var(--gold-gradient); font-weight: bold; font-size: 14px; text-transform: uppercase; }

        input[type="text"], textarea {
            background: #1a1a1a;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 15px;
            color: #fff;
            font-size: 16px;
            width: 100%;
            transition: 0.3s;
        }

        input:focus, textarea:focus { border-color: var(--saffron); outline: none; box-shadow: 0 0 10px rgba(255,153,51,0.2); }

        .btn-container {
            grid-column: span 2;
            display: flex; gap: 20px;
            margin-top: 20px;
        }

        .action-btn {
            flex: 1;
            padding: 20px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 800;
            cursor: pointer;
            transition: 0.3s;
            border: none;
            text-transform: uppercase;
        }

        .btn-live { background: var(--gold-gradient); color: #000; }
        .btn-live:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(179,135,40,0.4); }

        .btn-clear { background: #333; color: #fff; }

        /* Archive/History Style */
        .archive-section {
            margin-top: 40px;
            border-top: 2px solid #333;
            padding-top: 30px;
        }

        .history-card {
            background: #1a1a1a;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            border-left: 5px solid #444;
            transition: 0.3s;
        }

        .history-card:hover { border-left-color: var(--saffron); background: #222; }

        .history-summary { display: flex; justify-content: space-between; align-items: center; }

        .history-details {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background: #000;
            border-radius: 8px;
            font-size: 14px;
            color: #bbb;
            line-height: 1.6;
        }

        .status-badge {
            background: #004d00; color: #0f0; padding: 4px 10px; border-radius: 4px; font-size: 10px;
        }
    </style>
</head>
<body>

    <div class="overlay-container" id="capture-area">
        <div class="bg-pattern"></div>
        
        <header class="header-section">
            <h1 id="view-main-title" class="main-title">सहयोग राशि सूची</h1>
            <div id="view-sub-title" class="sub-title">श्रीमद्भागवत कथा महोत्सव</div>
        </header>

        <main class="list-viewport" id="list-render-engine">
            </main>
    </div>

    <section class="admin-dashboard">
        <div class="admin-header">
            <div>
                <h2 style="margin:0; color:var(--saffron);">SATSANG BROADCAST ENGINE v4.0</h2>
                <small style="color:#666;">Professional Stream Management Dashboard</small>
            </div>
            <div id="live-indicator"><span class="status-badge">SYSTEM ONLINE</span></div>
        </div>

        <div class="admin-grid">
            <div class="control-group">
                <label>1. हेडलाइन मैनेजमेंट (Headlines)</label>
                <input type="text" id="input-main-title" placeholder="मुख्य शीर्षक (जैसे: राम कथा सहयोग)">
                <input type="text" id="input-sub-title" placeholder="उप-शीर्षक (जैसे: दिनांक: 05 Feb 2026)">
                
                <label style="margin-top:10px;">2. प्रोग्राम का नाम (Archive Label)</label>
                <input type="text" id="input-program-name" placeholder="उदा: भागवत कथा - हरिद्वार">
            </div>

            <div class="control-group">
                <label>3. डोनर डेटा (Name - Amount)</label>
                <textarea id="input-raw-data" style="height: 185px;" 
                    placeholder="हर लाइन में एक नाम लिखें:&#10;रमेश पटेल - 5100&#10;अशोक खन्ना - 11000"></textarea>
            </div>

            <div class="btn-container">
                <button class="action-btn btn-live" onclick="publishLive()">Live Update & Save Archive</button>
                <button class="action-btn btn-clear" onclick="clearInputs()">Reset Inputs</button>
            </div>
        </div>

        <div class="archive-section">
            <h3 style="color:var(--gold-gradient);">डेटा आर्काइव (Session History)</h3>
            <p style="color:#666; font-size: 13px;">नीचे दिए गए सत्र पर क्लिक करके पूरी लिस्ट और टोटल चेक करें।</p>
            <div id="archive-render-area">
                </div>
        </div>
    </section>

    <script>
        // --- 1. FIREBASE INITIALIZATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyBTbD8UfPZNrIUu6zIamoPeAPp_jnuxTpE",
            databaseURL: "https://doner-speaker-list-default-rtdb.firebaseio.com",
            projectId: "doner-speaker-list"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // --- 2. CORE VARIABLES ---
        let globalDonorList = [];
        let currentPageIndex = 0;
        const ITEMS_PER_PAGE = 10;
        const PAGE_DURATION = 10000; // 10 Seconds

        // --- 3. PUBLISH FUNCTION (Save to Firebase) ---
        function publishLive() {
            const mTitle = document.getElementById('input-main-title').value || "धर्म सेवा सूची";
            const sTitle = document.getElementById('input-sub-title').value || "लाइव प्रोग्राम";
            const progName = document.getElementById('input-program-name').value || "General Session";
            const rawText = document.getElementById('input-raw-data').value;

            if(!rawText.trim()) { alert("कृपया नाम और राशि भरें!"); return; }

            const timestamp = new Date().toLocaleString('hi-IN');
            
            // Calculate Total Amount
            let totalAmount = 0;
            const lines = rawText.trim().split('\n').filter(l => l.includes('-'));
            lines.forEach(l => {
                const amt = parseInt(l.split('-')[1].replace(/[^0-9]/g, '')) || 0;
                totalAmount += amt;
            });

            // Update Realtime Display Node
            database.ref('live_v4_display').set({
                mainTitle: mTitle,
                subTitle: sTitle,
                rawData: rawText,
                lastSync: Date.now()
            });

            // Push to Archive Node
            database.ref('broadcast_history').push({
                program: progName,
                dateTime: timestamp,
                totalAmount: totalAmount,
                donorCount: lines.length,
                fullList: rawText
            });

            alert("डेटा लाइव कर दिया गया है और आर्काइव में सुरक्षित है!");
        }

        // --- 4. REALTIME LISTENER FOR DISPLAY ---
        database.ref('live_v4_display').on('value', (snapshot) => {
            const data = snapshot.val();
            if(!data) return;

            // Update Header Text
            document.getElementById('view-main-title').innerText = data.mainTitle;
            document.getElementById('view-sub-title').innerText = data.subTitle;
            
            // Populate Input Fields (for Sync across devices)
            document.getElementById('input-main-title').value = data.mainTitle;
            document.getElementById('input-sub-title').value = data.subTitle;
            document.getElementById('input-raw-data').value = data.rawData;

            // Process Data for Paging
            const lines = data.rawData.trim().split('\n').filter(l => l.includes('-'));
            globalDonorList = lines.map(l => {
                const parts = l.split('-');
                return { name: parts[0].trim(), amount: parts[1].trim() };
            });

            currentPageIndex = 0;
            runEngine();
        });

        // --- 5. THE RENDER ENGINE (The Pagination Logic) ---
        function runEngine() {
            const container = document.getElementById('list-render-engine');
            container.style.opacity = '0'; // Start fade out

            setTimeout(() => {
                container.innerHTML = "";
                const start = currentPageIndex * ITEMS_PER_PAGE;
                const end = start + ITEMS_PER_PAGE;
                const pageData = globalDonorList.slice(start, end);

                if(pageData.length === 0 && globalDonorList.length > 0) {
                    currentPageIndex = 0;
                    runEngine();
                    return;
                }

                const pageWrapper = document.createElement('div');
                pageWrapper.className = 'donor-page';

                pageData.forEach((item, index) => {
                    const row = document.createElement('div');
                    row.className = 'donor-item';
                    row.style.animationDelay = (index * 0.1) + 's';
                    row.innerHTML = `
                        <div class="donor-identity">
                            <div class="donor-rank">${start + index + 1}</div>
                            <div class="donor-name">${item.name}</div>
                        </div>
                        <div class="donor-amount">₹${item.amount}</div>
                    `;
                    pageWrapper.appendChild(row);
                });

                container.appendChild(pageWrapper);
                container.style.opacity = '1'; // Fade in

                // Schedule next page if needed
                if(globalDonorList.length > ITEMS_PER_PAGE) {
                    setTimeout(() => {
                        currentPageIndex++;
                        runEngine();
                    }, PAGE_DURATION);
                }
            }, 800);
        }

        // --- 6. ARCHIVE RENDERER ---
        database.ref('broadcast_history').on('value', (snapshot) => {
            const archiveArea = document.getElementById('archive-render-area');
            archiveArea.innerHTML = "";

            snapshot.forEach(child => {
                const log = child.val();
                const card = document.createElement('div');
                card.className = 'history-card';
                card.innerHTML = `
                    <div class="history-summary">
                        <div>
                            <strong style="color:var(--gold-gradient); font-size:18px;">${log.program}</strong><br>
                            <small style="color:#888;">${log.dateTime}</small>
                        </div>
                        <div style="text-align:right">
                            <span style="color:var(--saffron); font-weight:bold; font-size:20px;">₹${log.totalAmount.toLocaleString('hi-IN')}</span><br>
                            <small>${log.donorCount} डोनर्स</small>
                        </div>
                    </div>
                    <div class="history-details">
                        <strong>विस्तृत सूची:</strong><br>
                        ${log.fullList.replace(/\n/g, '<br>')}
                    </div>
                `;

                card.onclick = function() {
                    const details = this.querySelector('.history-details');
                    details.style.display = (details.style.display === 'block') ? 'none' : 'block';
                };

                archiveArea.prepend(card);
            });
        });

        // --- 7. UTILS ---
        function clearInputs() {
            if(confirm("क्या आप वाकई इनपुट खाली करना चाहते हैं?")) {
                document.getElementById('input-raw-data').value = "";
                document.getElementById('input-program-name').value = "";
            }
        }
    </script>
</body>
</html>
