<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Satsang Ultra-Premium Sidebar</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

    <style>
        :root {
            --saffron: #FF9933;
            --gold: #D4AF37;
            --deep-maroon: #4a0404;
            --glass: rgba(255, 255, 255, 0.1);
            --neon-gold: 0 0 15px rgba(212, 175, 55, 0.6);
        }

        body {
            margin: 0; padding: 0;
            background: transparent; /* OBS के लिए पारदर्शी */
            font-family: 'Poppins', 'Segoe UI', sans-serif;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* --- 4:6 PRO SIDEBAR --- */
        .sidebar-wrapper {
            width: 450px;
            height: 750px;
            position: relative;
            background: linear-gradient(165deg, var(--deep-maroon) 0%, #1a0101 100%);
            border: 2px solid var(--gold);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 50px rgba(0,0,0,0.8);
            margin-top: 20px;
        }

        /* Animated Border Light */
        .sidebar-wrapper::after {
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: conic-gradient(transparent, transparent, var(--gold), transparent);
            animation: rotateBorder 6s linear infinite;
            z-index: 1; pointer-events: none;
        }
        @keyframes rotateBorder { 100% { transform: rotate(360deg); } }

        .inner-content {
            position: absolute; inset: 4px;
            background: linear-gradient(180deg, rgba(74, 4, 4, 0.9) 0%, rgba(20, 0, 0, 0.98) 100%);
            border-radius: 16px; z-index: 2; overflow: hidden;
            display: flex; flex-direction: column;
        }

        /* Premium Header */
        .header-container {
            padding: 30px 10px;
            text-align: center;
            background: linear-gradient(90deg, #300, #800, #300);
            border-bottom: 3px solid var(--gold);
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }

        .header-title {
            font-size: 28px; font-weight: 800; text-transform: uppercase;
            letter-spacing: 2px; color: var(--gold);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin: 0; animation: pulseTitle 3s infinite;
        }

        @keyframes pulseTitle {
            0%, 100% { filter: drop-shadow(0 0 2px var(--gold)); }
            50% { filter: drop-shadow(0 0 10px var(--gold)); }
        }

        /* Donor List Styling */
        #list-viewport {
            flex-grow: 1; padding: 25px;
            display: flex; flex-direction: column; gap: 15px;
            position: relative;
        }

        .donor-card {
            background: var(--glass);
            border: 1px solid rgba(212, 175, 55, 0.3);
            border-radius: 12px;
            padding: 18px;
            display: flex; align-items: center; justify-content: space-between;
            backdrop-filter: blur(10px);
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            animation: fadeInRight 0.8s ease forwards;
        }

        .donor-info { display: flex; align-items: center; gap: 15px; }
        .rank-circle {
            width: 35px; height: 35px; background: var(--gold);
            border-radius: 50%; color: black; font-weight: bold;
            display: flex; align-items: center; justify-content: center;
            font-size: 18px; box-shadow: var(--neon-gold);
        }

        .donor-name { font-size: 22px; font-weight: 500; color: #fff; }
        .donor-amount {
            font-size: 24px; font-weight: 700; color: var(--saffron);
            text-shadow: 0 0 10px rgba(255, 153, 51, 0.4);
        }

        /* Footer / Live Signal */
        .footer-signal {
            padding: 15px; text-align: center; font-size: 12px;
            color: rgba(255,255,255,0.4); letter-spacing: 3px;
        }

        .dot { height: 8px; width: 8px; background-color: #f00; border-radius: 50%; display: inline-block; margin-right: 5px; animation: blink 1s infinite; }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }

        /* --- ADVANCED ADMIN PANEL --- */
        .admin-panel {
            width: 900px; background: #111; margin: 40px 0; border-radius: 20px;
            border: 1px solid #333; padding: 30px; box-shadow: 0 0 40px rgba(0,0,0,1);
        }

        .admin-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        
        .input-group h3 { color: var(--gold); margin-bottom: 15px; font-size: 20px; }
        
        textarea {
            width: 100%; height: 250px; background: #050505; border: 1px solid #444;
            border-radius: 10px; color: #0f0; padding: 15px; font-family: monospace;
            font-size: 16px; outline: none; transition: 0.3s;
        }
        textarea:focus { border-color: var(--gold); box-shadow: 0 0 10px rgba(212, 175, 55, 0.2); }

        .stats-card {
            background: #1a1a1a; border-radius: 10px; padding: 20px;
            border-left: 5px solid var(--gold); margin-bottom: 20px;
        }

        .stat-val { font-size: 35px; font-weight: bold; color: var(--gold); }

        .btn-row { grid-column: span 2; display: flex; gap: 20px; margin-top: 20px; }
        
        button {
            padding: 18px; border-radius: 10px; font-weight: bold; font-size: 18px;
            cursor: pointer; transition: 0.3s; border: none; flex: 1;
        }
        .btn-save { background: var(--gold); color: black; }
        .btn-save:hover { background: white; transform: scale(1.02); }
        .btn-end { background: #600; color: white; }
        .btn-end:hover { background: #f00; }

        #final-report {
            grid-column: span 2; background: #000; border: 1px dashed var(--gold);
            padding: 20px; margin-top: 20px; display: none;
        }
    </style>
</head>
<body>

    <div class="sidebar-wrapper">
        <div class="inner-content">
            <div class="header-container">
                <h1 class="header-title">धर्म सेवा सहयोगी</h1>
            </div>

            <div id="list-viewport">
                </div>

            <div class="footer-signal">
                <span class="dot"></span> सत्र सक्रिय (SESSION ACTIVE)
            </div>
        </div>
    </div>

    <div class="admin-panel">
        <div class="admin-grid">
            <div class="input-group">
                <h3>डेटा इनपुट (नाम - राशि)</h3>
                <textarea id="data-input" oninput="calculateLiveStats()" placeholder="उदाहरण:&#10;राहुल शर्मा - 501&#10;अशोक कुमार - 2100"></textarea>
            </div>

            <div class="input-group">
                <h3>लाइव सांख्यिकी (Live Stats)</h3>
                <div class="stats-card">
                    <div>कुल दानदाता (Total Donors)</div>
                    <div id="stat-count" class="stat-val">0</div>
                </div>
                <div class="stats-card">
                    <div>कुल संग्रहित राशि (Grand Total)</div>
                    <div id="stat-sum" class="stat-val">₹0</div>
                </div>
            </div>

            <div class="btn-row">
                <button class="btn-save" onclick="updateFirebase()">लाइव स्ट्रीम पर भेजें</button>
                <button class="btn-end" onclick="generateFinalReport()">सत्र समाप्त करें और रिपोर्ट देखें</button>
            </div>

            <div id="final-report">
                <h2 style="color:var(--gold)">अंतिम रिपोर्ट (Final Report)</h2>
                <div id="report-content"></div>
                <button onclick="this.parentElement.style.display='none'" style="margin-top:10px; padding:5px 15px; font-size:12px">बंद करें</button>
            </div>
        </div>
    </div>

    <script>
        // --- FIREBASE CONFIGURATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyBTbD8UfPZNrIUu6zIamoPeAPp_jnuxTpE",
            databaseURL: "https://doner-speaker-list-default-rtdb.firebaseio.com",
            projectId: "doner-speaker-list"
        };
        firebase.initializeApp(firebaseConfig);
        const dbRef = firebase.database().ref('v2_premium_session');

        let donorArray = [];
        let pageIndex = 0;
        const itemsPerPage = 5;

        // --- CALCULATE LIVE STATS ---
        function calculateLiveStats() {
            const raw = document.getElementById('data-input').value;
            const lines = raw.trim().split('\n').filter(l => l.includes('-'));
            let total = 0;
            
            lines.forEach(line => {
                const amt = parseInt(line.split('-')[1].replace(/[^0-9]/g, '')) || 0;
                total += amt;
            });

            document.getElementById('stat-count').innerText = lines.length;
            document.getElementById('stat-sum').innerText = "₹" + total.toLocaleString('hi-IN');
        }

        // --- UPDATE FIREBASE ---
        function updateFirebase() {
            const raw = document.getElementById('data-input').value;
            dbRef.set({
                raw: raw,
                lastUpdate: Date.now()
            }).then(() => {
                alert("डेटा सफलतापूर्वक लाइव कर दिया गया है!");
            });
        }

        // --- LISTEN FOR CHANGES ---
        dbRef.on('value', (snapshot) => {
            const val = snapshot.val();
            if (val && val.raw) {
                document.getElementById('data-input').value = val.raw;
                calculateLiveStats();
                parseAndCycle(val.raw);
            }
        });

        function parseAndCycle(rawText) {
            const lines = rawText.trim().split('\n').filter(l => l.includes('-'));
            donorArray = lines.map(line => {
                const parts = line.split('-');
                return { name: parts[0].trim(), amount: parts[1].trim() };
            });
            pageIndex = 0;
            showNextPage();
        }

        function showNextPage() {
            const viewport = document.getElementById('list-viewport');
            
            // Exit animation for old cards
            const oldCards = viewport.querySelectorAll('.donor-card');
            oldCards.forEach(c => {
                c.style.opacity = '0';
                c.style.transform = 'translateX(-50px)';
            });

            setTimeout(() => {
                viewport.innerHTML = "";
                const start = pageIndex * itemsPerPage;
                const end = start + itemsPerPage;
                const currentItems = donorArray.slice(start, end);

                if (currentItems.length === 0 && donorArray.length > 0) {
                    pageIndex = 0;
                    showNextPage();
                    return;
                }

                currentItems.forEach((item, i) => {
                    const card = document.createElement('div');
                    card.className = 'donor-card';
                    card.style.animationDelay = (i * 0.1) + 's';
                    card.innerHTML = `
                        <div class="donor-info">
                            <div class="rank-circle">${start + i + 1}</div>
                            <div class="donor-name">${item.name}</div>
                        </div>
                        <div class="donor-amount">₹${item.amount}</div>
                    `;
                    viewport.appendChild(card);
                });

                if (donorArray.length > itemsPerPage) {
                    setTimeout(() => {
                        pageIndex++;
                        showNextPage();
                    }, 10000); // 10 seconds hold
                }
            }, 800);
        }

        // --- FINAL REPORT ---
        function generateFinalReport() {
            const content = document.getElementById('report-content');
            const totalAmt = document.getElementById('stat-sum').innerText;
            const totalCount = document.getElementById('stat-count').innerText;
            
            let list = "<ol style='color:#ccc; max-height:200px; overflow-y:auto;'>";
            donorArray.forEach(d => list += `<li>${d.name} - ₹${d.amount}</li>`);
            list += "</ol>";

            content.innerHTML = `
                <p>कुल प्राप्त दान: <span style="color:gold; font-size:20px">${totalAmt}</span></p>
                <p>कुल दानदाता: ${totalCount}</p>
                ${list}
            `;
            document.getElementById('final-report').style.display = 'block';
        }
    </script>
</body>
</html>
