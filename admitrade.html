<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trade Nova | Master Admin Control</title>

    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <style>
        :root {
            --primary: #00e5ff;
            --primary-glow: rgba(0, 229, 255, 0.4);
            --bg-deep: #020b13;
            --card-glass: rgba(11, 31, 45, 0.9);
            --text-bright: #ffffff;
            --text-dim: #b5dfff;
            --danger: #ff4d4d;
            --success: #00ff88;
            --warning: #ffb300;
        }

        * { box-sizing: border-box; transition: all 0.2s ease; }

        body {
            margin: 0;
            font-family: 'Inter', sans-serif;
            background: radial-gradient(circle at top right, #0a2e46, #020b13);
            background-attachment: fixed;
            color: var(--text-bright);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* --- Custom Scrollbar --- */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-deep); }
        ::-webkit-scrollbar-thumb { background: var(--card-glass); border-radius: 10px; border: 1px solid var(--primary); }

        /* --- Login Section (Detailed) --- */
        #adminAuth {
            position: fixed;
            inset: 0;
            z-index: 10000;
            background: var(--bg-deep);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .auth-card {
            background: var(--card-glass);
            padding: 45px;
            border-radius: 30px;
            border: 1px solid rgba(0, 229, 255, 0.3);
            text-align: center;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.8);
        }

        .auth-card i {
            font-size: 50px;
            color: var(--primary);
            text-shadow: 0 0 15px var(--primary-glow);
            margin-bottom: 20px;
        }

        .auth-input-group {
            position: relative;
            margin: 25px 0;
        }

        .auth-input-group input {
            width: 100%;
            padding: 15px 20px;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: white;
            font-size: 16px;
            outline: none;
            text-align: center;
            letter-spacing: 4px;
        }

        .auth-input-group input:focus { border-color: var(--primary); box-shadow: 0 0 15px var(--primary-glow); }

        /* --- Dashboard UI --- */
        .dashboard-layout {
            padding: 30px;
            max-width: 1400px;
            margin: 0 auto;
            display: none; /* Initially hidden */
        }

        .top-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding: 20px;
            background: var(--card-glass);
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .logo-area h1 {
            font-family: 'Montserrat', sans-serif;
            margin: 0;
            font-size: 24px;
            background: linear-gradient(45deg, #fff, var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* --- Metrics Grid --- */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .metric-card {
            background: var(--card-glass);
            padding: 30px;
            border-radius: 24px;
            border: 1px solid rgba(255,255,255,0.05);
            position: relative;
            overflow: hidden;
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 4px; height: 100%;
            background: var(--primary);
        }

        .metric-card h3 { color: var(--text-dim); font-size: 14px; margin: 0 0 10px 0; text-transform: uppercase; letter-spacing: 1px; }
        .metric-card h2 { font-size: 36px; margin: 0; font-family: 'Montserrat'; }

        /* --- Control Center (The Table Area) --- */
        .control-panel {
            background: var(--card-glass);
            border-radius: 24px;
            border: 1px solid rgba(255,255,255,0.05);
            padding: 30px;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 25px;
        }

        .search-wrapper {
            position: relative;
            flex: 1;
            max-width: 400px;
        }

        .search-wrapper i { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: var(--primary); }

        .search-wrapper input {
            width: 100%;
            padding: 12px 15px 12px 45px;
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            color: white;
            outline: none;
        }

        /* --- Detailed Table --- */
        .table-responsive { overflow-x: auto; }

        table { width: 100%; border-collapse: separate; border-spacing: 0 10px; }

        th {
            text-align: left;
            padding: 15px;
            color: var(--primary);
            font-family: 'Montserrat';
            font-size: 12px;
            letter-spacing: 1px;
            text-transform: uppercase;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        td {
            padding: 20px 15px;
            background: rgba(255,255,255,0.02);
            border-top: 1px solid rgba(255,255,255,0.03);
            border-bottom: 1px solid rgba(255,255,255,0.03);
        }

        td:first-child { border-left: 1px solid rgba(255,255,255,0.03); border-radius: 15px 0 0 15px; }
        td:last-child { border-right: 1px solid rgba(255,255,255,0.03); border-radius: 0 15px 15px 0; }

        .user-name { font-weight: 600; color: #fff; display: block; }
        .user-sub { font-size: 11px; color: var(--text-dim); }

        .pass-chip {
            font-family: monospace;
            background: rgba(0, 229, 255, 0.1);
            color: var(--primary);
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 13px;
        }

        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .active-bg { background: rgba(0, 255, 136, 0.1); color: var(--success); }

        .action-btns { display: flex; gap: 10px; }

        .icon-btn {
            width: 35px; height: 35px; border-radius: 10px;
            border: none; cursor: pointer; display: flex;
            align-items: center; justify-content: center; font-size: 14px;
        }

        .btn-edit { background: rgba(0, 229, 255, 0.1); color: var(--primary); }
        .btn-edit:hover { background: var(--primary); color: #000; }
        .btn-del { background: rgba(255, 77, 77, 0.1); color: var(--danger); }
        .btn-del:hover { background: var(--danger); color: #fff; }

        .hidden { display: none !important; }

        @media (max-width: 768px) {
            .metrics-grid { grid-template-columns: 1fr; }
            .top-nav { flex-direction: column; gap: 15px; text-align: center; }
        }
    </style>
</head>
<body>

    <div id="adminAuth">
        <div class="auth-card">
            <i class="fa-solid fa-unlock-keyhole"></i>
            <h1 style="font-family: Montserrat; margin: 0;">Master Panel</h1>
            <p style="color: var(--text-dim); margin-bottom: 25px;">Trade Nova Administration</p>
            
            <div class="auth-input-group">
                <input type="password" id="masterPass" placeholder="••••••">
            </div>

            <button onclick="handleLogin()" style="width: 100%; padding: 15px; border-radius: 12px; border: none; background: var(--primary); color: #000; font-weight: bold; cursor: pointer; font-size: 16px;">
                AUTHORIZE ACCESS
            </button>
            <p id="errorMsg" style="color: var(--danger); margin-top: 15px; font-size: 13px; display: none;">Invalid Access Key!</p>
        </div>
    </div>

    <div id="mainDashboard" class="dashboard-layout">
        
        <nav class="top-nav">
            <div class="logo-area">
                <h1>TRADE NOVA <span style="font-weight: 300; font-size: 14px; color: var(--text-dim);">CONTROL CENTER</span></h1>
            </div>
            <div style="display: flex; gap: 15px; align-items: center;">
                <span id="currentDate" style="font-size: 13px; color: var(--text-dim);"></span>
                <button onclick="location.reload()" class="icon-btn btn-del" title="Logout"><i class="fa-solid fa-power-off"></i></button>
            </div>
        </nav>

        <div class="metrics-grid">
            <div class="metric-card">
                <h3>Total Members</h3>
                <h2 id="mTotal">0</h2>
                <div style="font-size: 11px; color: var(--success); margin-top: 10px;"><i class="fa-solid fa-users"></i> Lifetime Users</div>
            </div>
            <div class="metric-card">
                <h3>Active Today</h3>
                <h2 id="mToday">0</h2>
                <div style="font-size: 11px; color: var(--primary); margin-top: 10px;"><i class="fa-solid fa-chart-line"></i> New Registrations</div>
            </div>
            <div class="metric-card">
                <h3>System Status</h3>
                <h2 style="color: var(--success); font-size: 22px;">OPERATIONAL</h2>
                <div style="font-size: 11px; color: var(--text-dim); margin-top: 10px;"><i class="fa-solid fa-server"></i> Firebase Linked</div>
            </div>
        </div>

        <div class="control-panel">
            <div class="panel-header">
                <h2 style="font-size: 20px;">User Management</h2>
                <div class="search-wrapper">
                    <i class="fa-solid fa-magnifying-glass"></i>
                    <input type="text" id="userSearch" placeholder="Find user by phone or name..." onkeyup="searchUser()">
                </div>
                <button onclick="fetchDatabase()" style="background: none; border: 1px solid var(--primary); color: var(--primary); padding: 10px 20px; border-radius: 10px; cursor: pointer; font-size: 13px;">
                    <i class="fa-solid fa-arrows-rotate"></i> REFRESH
                </button>
            </div>

            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th>User Profile</th>
                            <th>Contact</th>
                            <th>Access Key</th>
                            <th>Registration Date</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="userContent">
                        </tbody>
                </table>
            </div>
            
            <div id="emptyState" class="hidden" style="text-align: center; padding: 50px;">
                <i class="fa-solid fa-folder-open" style="font-size: 40px; color: var(--text-dim); margin-bottom: 15px;"></i>
                <p>No records found in database.</p>
            </div>
        </div>

        <footer style="text-align: center; margin-top: 40px; color: var(--text-dim); font-size: 12px; letter-spacing: 1px;">
            © 2026 TRADE NOVA CLUB | MASTER ADMIN v2.0
        </footer>
    </div>

<script>
// --- 1. CONFIGURATION & FIREBASE ---
firebase.initializeApp({
  apiKey: "AIzaSyDdlhcnyqPJACCF0Aen8NLga8bkBzATNFM",
  authDomain: "tradenovaaccess.firebaseapp.com",
  projectId: "tradenovaaccess"
});
const db = firebase.firestore();

// Set Current Date in Header
document.getElementById('currentDate').innerText = new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

// --- 2. AUTHENTICATION LOGIC ---
function handleLogin() {
    const input = document.getElementById('masterPass').value;
    const error = document.getElementById('errorMsg');

    // Admin Password: admin123
    if(input === "admin123") {
        document.getElementById('adminAuth').style.display = 'none';
        document.getElementById('mainDashboard').style.display = 'block';
        fetchDatabase();
    } else {
        error.style.display = 'block';
        setTimeout(() => { error.style.display = 'none'; }, 2000);
    }
}

// --- 3. DATABASE OPERATIONS ---
async function fetchDatabase() {
    const tableBody = document.getElementById('userContent');
    const emptyState = document.getElementById('emptyState');
    
    tableBody.innerHTML = `<tr><td colspan="6" style="text-align:center; padding: 40px;">
        <i class="fa-solid fa-circle-notch fa-spin"></i> Loading Data Records...
    </td></tr>`;

    try {
        const snapshot = await db.collection("users").orderBy("created", "desc").get();
        
        if (snapshot.empty) {
            tableBody.innerHTML = "";
            emptyState.classList.remove('hidden');
            return;
        }

        emptyState.classList.add('hidden');
        let rows = "";
        let total = 0;
        let todayCount = 0;
        const today = new Date().toDateString();

        snapshot.forEach(doc => {
            const data = doc.data();
            total++;

            // Decrypt password
            let decodedPass = "Encrypted";
            try { decodedPass = atob(data.password); } catch(e) { decodedPass = "Invalid Hash"; }

            // Handle Registration Date
            let dateUI = "N/A";
            if (data.created) {
                const jsDate = data.created.toDate ? data.created.toDate() : new Date(data.created);
                dateUI = jsDate.toLocaleDateString('en-GB', { day:'2-digit', month:'short', year:'numeric' });
                if(jsDate.toDateString() === today) todayCount++;
            }

            rows += `
                <tr class="user-row">
                    <td>
                        <span class="user-name">${data.name || 'Anonymous'}</span>
                        <span class="user-sub">UID: ${doc.id.substring(0,6)}...</span>
                    </td>
                    <td><i class="fa-solid fa-phone" style="font-size:10px; color:var(--primary)"></i> ${data.phone}</td>
                    <td><span class="pass-chip">${decodedPass}</span></td>
                    <td style="font-size: 13px;">${dateUI}</td>
                    <td><span class="status-badge active-bg">● ACTIVE</span></td>
                    <td>
                        <div class="action-btns">
                            <button class="icon-btn btn-edit" title="Reset Password" onclick="modifyUser('${doc.id}')"><i class="fa-solid fa-pen-to-square"></i></button>
                            <button class="icon-btn btn-del" title="Delete User" onclick="removeUser('${doc.id}')"><i class="fa-solid fa-trash-can"></i></button>
                        </div>
                    </td>
                </tr>
            `;
        });

        tableBody.innerHTML = rows;
        document.getElementById('mTotal').innerText = total;
        document.getElementById('mToday').innerText = todayCount;

    } catch (error) {
        console.error("Firebase Sync Error:", error);
        tableBody.innerHTML = `<tr><td colspan="6" style="text-align:center; color: var(--danger);">Sync Error: ${error.message}</td></tr>`;
    }
}

// --- 4. ACTION FUNCTIONS ---
async function removeUser(id) {
    if(confirm("DANGER: Permanently delete user " + id + "?")) {
        try {
            await db.collection("users").doc(id).delete();
            fetchDatabase();
        } catch(e) { alert("Delete failed: " + e.message); }
    }
}

async function modifyUser(id) {
    const newPass = prompt("Set NEW password for user " + id + ":");
    if(newPass && newPass.trim() !== "") {
        try {
            await db.collection("users").doc(id).update({
                password: btoa(newPass)
            });
            alert("SUCCESS: User access updated.");
            fetchDatabase();
        } catch(e) { alert("Update failed: " + e.message); }
    }
}

// --- 5. SEARCH LOGIC ---
function searchUser() {
    const input = document.getElementById('userSearch').value.toLowerCase();
    const rows = document.getElementsByClassName('user-row');

    Array.from(rows).forEach(row => {
        const text = row.innerText.toLowerCase();
        row.style.display = text.includes(input) ? "" : "none";
    });
}
</script>
</body>
</html>
