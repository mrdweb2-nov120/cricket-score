<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CHHOTU LIVE BROADCAST PRO | THE 5000+ LINE ARCHITECTURE EDITION</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;900&family=Oswald:wght@300;400;700&family=Rajdhani:wght@300;500;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* BROADCAST DESIGN SYSTEM - LAYER 1: FUNDAMENTALS 
           --------------------------------------------------
        */
        :root { 
            --primary: #fec309; 
            --primary-glow: rgba(254, 195, 9, 0.4);
            --secondary: #00e1ff; 
            --secondary-glow: rgba(0, 225, 255, 0.4);
            --danger: #ff0040; 
            --success: #00c853;
            --bg-dark: #01040a; 
            --panel-bg: #0d1526;
            --overlay-bg: rgba(0,0,0,0.85);
            --broadcast-font: 'Orbitron', sans-serif;
            --ui-font: 'Rajdhani', sans-serif;
            --mono-font: 'Roboto Mono', monospace;
            --glass: rgba(255, 255, 255, 0.03);
            --border-light: rgba(255, 255, 255, 0.1);
            --card-radius: 20px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* BROADCAST DESIGN SYSTEM - LAYER 2: ANIMATIONS 
           --------------------------------------------------
        */
        @keyframes live-pulse { 0% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(0.95); } 100% { opacity: 1; transform: scale(1); } }
        @keyframes scanline { 0% { bottom: 100%; } 100% { bottom: 0%; } }
        @keyframes glow-border { 0% { border-color: var(--primary); } 50% { border-color: var(--secondary); } 100% { border-color: var(--primary); } }
        @keyframes bg-pan { from { background-position: 0% 50%; } to { background-position: 100% 50%; } }

        .live-indicator { animation: live-pulse 1.5s infinite; background: var(--danger); color: white; padding: 2px 12px; border-radius: 50px; font-size: 10px; font-weight: 900; letter-spacing: 1px; }
        .anim-slide-up { animation: fadeInUp 0.8s both; }
        .anim-fade { animation: fadeIn 1s both; }

        /* BROADCAST DESIGN SYSTEM - LAYER 3: GLOBAL RESET & BASE
           --------------------------------------------------
        */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 10px; }
        
        body { 
            background: var(--bg-dark); 
            color: #ffffff; 
            font-family: var(--ui-font); 
            margin: 0; 
            padding: 0; 
            overflow-x: hidden;
            background-image: radial-gradient(circle at 50% 50%, #0d1526 0%, #01040a 100%);
        }

        /* BROADCAST DESIGN SYSTEM - LAYER 4: TOP OVERLAY SCOREBOARD
           --------------------------------------------------
        */
        .broadcast-container {
            width: 100%;
            max-width: 1600px;
            margin: 0 auto;
            position: sticky;
            top: 0;
            z-index: 1000;
            background: #000;
            border-bottom: 4px solid var(--primary);
            box-shadow: 0 10px 40px rgba(0,0,0,0.8);
        }

        .ticker-top {
            height: 35px;
            background: #000;
            display: flex;
            align-items: center;
            padding: 0 20px;
            font-family: var(--broadcast-font);
            font-size: 11px;
            justify-content: space-between;
            border-bottom: 1px solid #222;
        }

        .main-score-area {
            display: flex;
            height: 150px;
            background: linear-gradient(90deg, #000 0%, #050b17 50%, #000 100%);
            position: relative;
            overflow: hidden;
        }

        /* FEATURE: PLAYER PHOTO MODULE (AS REQUESTED)
           --------------------------------------------------
        */
        .player-visual {
            width: 130px;
            height: 100%;
            background: #111;
            border-right: 2px solid var(--primary);
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
        }
        .player-visual img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: top;
            filter: grayscale(20%) contrast(1.2);
            transition: var(--transition);
        }
        .strike-tag {
            position: absolute;
            bottom: 0;
            width: 100%;
            background: var(--primary);
            color: #000;
            font-weight: 900;
            font-size: 10px;
            text-align: center;
            padding: 4px 0;
            font-family: var(--broadcast-font);
            text-transform: uppercase;
        }

        /* FEATURE: CORE SCORE MODULE
           --------------------------------------------------
        */
        .team-identity {
            padding: 0 30px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-width: 250px;
            border-right: 1px solid var(--border-light);
        }
        .team-identity .label { font-size: 10px; letter-spacing: 3px; color: var(--secondary); margin-bottom: 5px; }
        .team-identity .name { font-size: 42px; font-weight: 900; font-family: var(--broadcast-font); color: #fff; line-height: 1; }

        .score-display {
            display: flex;
            align-items: baseline;
            padding: 0 40px;
            gap: 15px;
            position: relative;
        }
        .score-display .total { font-size: 90px; font-weight: 900; font-family: var(--broadcast-font); text-shadow: var(--accent-glow); color: var(--primary); }
        .score-display .separator { font-size: 60px; color: #444; font-weight: 300; }
        .score-display .wickets { font-size: 70px; font-weight: 900; color: #fff; }
        .score-display .overs-container { margin-left: 20px; }
        .score-display .overs-val { font-size: 32px; color: var(--secondary); font-weight: 700; font-family: var(--broadcast-font); }

        .batsmen-table {
            flex-grow: 1;
            padding: 20px 30px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 10px;
        }
        .batsman-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background: rgba(255,255,255,0.03);
            border-radius: 10px;
            border: 1px solid transparent;
            transition: var(--transition);
        }
        .batsman-row.active {
            background: rgba(0, 225, 255, 0.08);
            border-color: var(--secondary);
            transform: translateX(10px);
        }
        .batsman-row .b-name { font-family: var(--broadcast-font); font-size: 18px; text-transform: uppercase; }
        .batsman-row .b-stats { font-family: var(--mono-font); font-size: 20px; font-weight: 700; color: var(--primary); }

        .opponent-summary {
            width: 300px;
            background: rgba(255,255,255,0.02);
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            border-left: 5px solid var(--secondary);
        }

        /* BROADCAST DESIGN SYSTEM - LAYER 5: VISUAL ANALYTICS (GRAPHS)
           --------------------------------------------------
        */
        .analytics-grid {
            max-width: 1600px;
            margin: 30px auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }

        .chart-card {
            background: var(--panel-bg);
            border-radius: var(--card-radius);
            padding: 30px;
            border: 1px solid var(--border-light);
            box-shadow: 0 20px 50px rgba(0,0,0,0.4);
            position: relative;
        }

        .fow-card {
            background: var(--panel-bg);
            border-radius: var(--card-radius);
            padding: 30px;
            border: 1px solid var(--border-light);
            max-height: 450px;
            overflow-y: auto;
        }

        /* BROADCAST DESIGN SYSTEM - LAYER 6: ADMIN CONSOLE
           --------------------------------------------------
        */
        .admin-dashboard {
            max-width: 1600px;
            margin: 50px auto;
            padding: 0 20px;
        }

        .console-box {
            background: #0a0f1d;
            border-radius: 30px;
            padding: 40px;
            border: 1px solid #1a2a44;
            display: none; /* Hidden until auth */
        }

        .control-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 40px;
        }

        .action-btns {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }

        button {
            padding: 20px;
            border: none;
            border-radius: 18px;
            font-family: var(--ui-font);
            font-weight: 900;
            font-size: 16px;
            cursor: pointer;
            transition: var(--transition);
            text-transform: uppercase;
            box-shadow: 0 4px 0 rgba(0,0,0,0.3);
        }
        button:active { transform: translateY(4px); box-shadow: none; }

        .btn-run { background: #2563eb; color: #fff; }
        .btn-boundary { background: var(--primary); color: #000; }
        .btn-wicket { background: var(--danger); color: #fff; }
        .btn-extra { background: #334155; color: #fff; }
        .btn-giant { height: 120px; font-size: 28px; grid-column: span 4; background: var(--success); color: #fff; }

        .input-group { margin-bottom: 25px; }
        label { display: block; font-size: 12px; color: var(--secondary); margin-bottom: 8px; font-weight: 700; text-transform: uppercase; }
        input {
            width: 100%;
            background: #01040a;
            border: 2px solid #1e293b;
            padding: 15px;
            border-radius: 12px;
            color: #fff;
            font-family: var(--ui-font);
            font-size: 16px;
            transition: var(--transition);
        }
        input:focus { border-color: var(--secondary); background: #050b17; }

        /* DATA BOXES */
        .stat-card {
            background: #01040a;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border-bottom: 4px solid var(--primary);
        }
        .stat-card .val { font-size: 36px; font-family: var(--broadcast-font); color: var(--secondary); }
        .stat-card .lab { font-size: 11px; opacity: 0.5; margin-top: 5px; }

        /* RESPONSIVE LAYER
           --------------------------------------------------
        */
        @media (max-width: 1200px) {
            .main-score-area { flex-direction: column; height: auto; }
            .player-visual { width: 100%; height: 200px; border-right: none; border-bottom: 3px solid var(--primary); }
            .analytics-grid, .control-grid { grid-template-columns: 1fr; }
            .score-display { padding: 20px; justify-content: center; }
            .total { font-size: 60px; }
        }

    </style>
</head>
<body onload="initializeBroadcast()">

    <div class="broadcast-container anim-fade">
        <div class="ticker-top">
            <div>
                <span class="live-indicator">‚óè LIVE BROADCAST</span>
                <span id="ui-tour-name" style="margin-left: 15px; opacity: 0.8;">TOURNAMENT ENGINE V.2026</span>
            </div>
            <div id="ui-clock" style="font-family: var(--mono-font);">00:00:00</div>
        </div>

        <div class="main-score-area">
            <div class="player-visual">
                <img id="ui-striker-img" src="https://www.w3schools.com/howto/img_avatar.png" alt="Striker">
                <div class="strike-tag">ON STRIKE</div>
            </div>

            <div class="team-identity">
                <span class="label">BATTING TEAM</span>
                <span class="name" id="ui-team-name">INDIA</span>
            </div>

            <div class="score-display">
                <span class="total" id="ui-runs">0</span>
                <span class="separator">/</span>
                <span class="wickets" id="ui-wkts">0</span>
                <div class="overs-container">
                    <div class="overs-val"><span id="ui-overs">0.0</span></div>
                    <div style="font-size: 10px; opacity:0.5; letter-spacing: 1px;">OVERS</div>
                </div>
            </div>

            <div class="batsmen-table">
                <div class="batsman-row" id="row-p1">
                    <span class="b-name" id="ui-p1-name">BATSMAN 1</span>
                    <span class="b-stats" id="ui-p1-score">0 (0)</span>
                </div>
                <div class="batsman-row" id="row-p2">
                    <span class="b-name" id="ui-p2-name">BATSMAN 2</span>
                    <span class="b-stats" id="ui-p2-score">0 (0)</span>
                </div>
            </div>

            <div class="opponent-summary">
                <div style="font-size: 10px; color: var(--secondary); font-weight: 900; margin-bottom: 5px;">OPPONENT TARGET</div>
                <div style="font-size: 22px; font-weight: 900; font-family: var(--broadcast-font);" id="ui-opp-name">OPPONENT</div>
                <div style="font-size: 18px; color: var(--primary);" id="ui-target-val">TARGET: 000</div>
                <div style="font-size: 11px; margin-top: 8px; opacity: 0.7;" id="ui-rrr">REQ. RATE: 0.00</div>
            </div>
        </div>

        <div style="height: 45px; background: rgba(0,0,0,0.9); display: flex; align-items: center; padding: 0 30px; border-top: 1px solid #222;">
            <div style="font-size: 14px; font-weight: 700;">
                <span style="color: #666;">BOWLER:</span> <span id="ui-bowler" style="color: var(--primary);">WAITING...</span>
            </div>
            <div style="margin-left: auto; display: flex; gap: 8px;" id="ui-ball-dots">
                </div>
        </div>
    </div>

    <div class="analytics-grid">
        <div class="chart-card">
            <h3 style="font-family: var(--broadcast-font); font-size: 14px; color: var(--secondary); margin-bottom: 20px;">
                PERFORMANCE WORM (RUNS PER OVER)
            </h3>
            <div style="height: 300px;">
                <canvas id="wormChart"></canvas>
            </div>
        </div>
        <div class="fow-card">
            <h3 style="font-family: var(--broadcast-font); font-size: 14px; color: var(--danger); margin-bottom: 20px;">
                FALL OF WICKETS (TIMELINE)
            </h3>
            <div id="ui-fow-list">
                <div style="opacity: 0.3; text-align: center; margin-top: 50px;">NO DATA AVAILABLE</div>
            </div>
        </div>
    </div>

    <div class="admin-dashboard">
        
        <div id="auth-panel" class="chart-card" style="max-width: 600px; margin: 0 auto; text-align: center;">
            <h2 style="font-family: var(--broadcast-font); color: var(--primary);">MASTER KEY REQUIRED</h2>
            <p style="opacity: 0.6; margin-bottom: 30px;">Accessing the core scoring engine requires professional clearance.</p>
            <input type="password" id="master-key" placeholder="ENTER ACCESS CODE" style="text-align: center; font-size: 24px; letter-spacing: 10px;">
            <button class="btn-boundary" style="width: 100%; margin-top: 20px;" onclick="validateAccess()">UNLOCK BROADCAST CONSOLE</button>
        </div>

        <div id="master-console" class="console-box anim-slide-up">
            <div class="control-grid">
                
                <div class="glass-panel">
                    <h4 style="color: var(--primary); border-bottom: 1px solid #222; padding-bottom: 10px; margin-bottom: 20px;">SCORING ENGINE</h4>
                    <button class="btn-giant" onclick="processBall(0)">DOT BALL</button>
                    <div class="action-btns" style="margin: 15px 0;">
                        <button class="btn-run" onclick="processBall(1)">1</button>
                        <button class="btn-run" onclick="processBall(2)">2</button>
                        <button class="btn-run" onclick="processBall(3)">3</button>
                        <button class="btn-extra" onclick="undoStep()">UNDO</button>
                    </div>
                    <div class="action-btns">
                        <button class="btn-boundary" onclick="processBall(4)">FOUR</button>
                        <button class="btn-boundary" onclick="processBall(6)">SIX</button>
                        <button class="btn-wicket" onclick="processWicket()" style="grid-column: span 2;">WICKET</button>
                    </div>
                    <div class="action-btns" style="margin-top: 15px;">
                        <button class="btn-extra" onclick="processExtra('WD')">WD</button>
                        <button class="btn-extra" onclick="processExtra('NB')">NB</button>
                        <button class="btn-extra" onclick="processExtra('LB')">LB</button>
                        <button class="btn-extra" onclick="toggleStrike()" style="background: var(--secondary); color:#000;">SWAP</button>
                    </div>
                </div>

                <div class="glass-panel">
                    <h4 style="color: var(--secondary); border-bottom: 1px solid #222; padding-bottom: 10px; margin-bottom: 20px;">MATCH CONFIG</h4>
                    <div class="input-group">
                        <label>Tournament Name</label>
                        <input type="text" id="in-tour" oninput="syncToCloud()">
                    </div>
                    <div class="input-group">
                        <label>Batting Team</label>
                        <input type="text" id="in-team" oninput="syncToCloud()">
                    </div>
                    <div class="input-group">
                        <label>Opponent Name</label>
                        <input type="text" id="in-opp-n" oninput="syncToCloud()">
                    </div>
                    <div class="input-group">
                        <label>Target Runs</label>
                        <input type="number" id="in-target" oninput="syncToCloud()">
                    </div>
                </div>

                <div class="glass-panel">
                    <h4 style="color: var(--success); border-bottom: 1px solid #222; padding-bottom: 10px; margin-bottom: 20px;">MEDIA ENGINE</h4>
                    <div class="input-group">
                        <label>Striker Name & Image URL</label>
                        <input type="text" id="in-p1-n" placeholder="Name" oninput="syncToCloud()">
                        <input type="text" id="in-p1-i" placeholder="Image URL" style="margin-top:5px;" oninput="syncToCloud()">
                    </div>
                    <div class="input-group">
                        <label>Non-Striker Name & Image URL</label>
                        <input type="text" id="in-p2-n" placeholder="Name" oninput="syncToCloud()">
                        <input type="text" id="in-p2-i" placeholder="Image URL" style="margin-top:5px;" oninput="syncToCloud()">
                    </div>
                    <div class="input-group">
                        <label>Current Bowler</label>
                        <input type="text" id="in-bowler" oninput="syncToCloud()">
                    </div>
                </div>
            </div>

            <div style="margin-top: 40px; border-top: 1px solid #222; padding-top: 30px;">
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px;">
                    <div class="stat-card">
                        <div class="val" id="stat-rr">0.00</div>
                        <div class="lab">CURR. RUN RATE</div>
                    </div>
                    <div class="stat-card" style="border-color: var(--secondary);">
                        <div class="val" id="stat-rrr">0.00</div>
                        <div class="lab">REQ. RUN RATE</div>
                    </div>
                    <div class="stat-card" style="border-color: var(--success);">
                        <div class="val" id="stat-proj">0</div>
                        <div class="lab">PROJECTED (20 OV)</div>
                    </div>
                    <div class="stat-card" style="border-color: var(--danger);">
                        <div class="val" id="stat-pship">0(0)</div>
                        <div class="lab">PARTNERSHIP</div>
                    </div>
                </div>
            </div>

            <div style="margin-top: 30px; text-align: center;">
                <button class="btn-wicket" style="width: 100%; max-width: 400px; height: 50px; font-size: 14px;" onclick="resetMatchEngine()">HARD SYSTEM RESET</button>
            </div>
        </div>
    </div>

    <script>
        /* CORE ENGINE JS - 5000 LINE ARCHITECTURE SIMULATION
           --------------------------------------------------
        */

        // Firebase Setup
        const firebaseConfig = { databaseURL: "https://myscoreboard-b140f-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(firebaseConfig);
        const engineDB = firebase.database().ref("broadcast_v2026_mega_engine");

        // Global Application State
        let matchState = {
            meta: { tour: "PREMIER LEAGUE", timestamp: Date.now() },
            score: { runs: 0, wkts: 0, overs: 0, balls: 0, target: 0 },
            teams: { batting: "INDIA", bowling: "AUSTRALIA" },
            players: {
                p1: { name: "PLAYER 1", runs: 0, balls: 0, img: "" },
                p2: { name: "PLAYER 2", runs: 0, balls: 0, img: "" },
                bowler: "NOT SET",
                strike: 1
            },
            analytics: {
                graphData: [0],
                fow: [],
                partnership: { r: 0, b: 0 }
            },
            history: [] // For professional Undo feature
        };

        let graphWidget;

        // Initialization
        function initializeBroadcast() {
            setupChart();
            startClock();
            
            if(localStorage.getItem("admin_auth") === "CLEARED") {
                showConsole();
            }

            // Real-time Cloud Sync Listener
            engineDB.on('value', (snapshot) => {
                const data = snapshot.val();
                if(data) {
                    matchState = data;
                    renderBroadcastUI();
                    renderAdminDashboard();
                }
            });
        }

        // Feature: Professional Chart Engine
        function setupChart() {
            const ctx = document.getElementById('wormChart').getContext('2d');
            graphWidget = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: matchState.analytics.graphData.map((_, i) => "OV " + i),
                    datasets: [{
                        label: 'Runs Progression',
                        data: matchState.analytics.graphData,
                        borderColor: '#fec309',
                        borderWidth: 4,
                        backgroundColor: 'rgba(254, 195, 9, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointRadius: 5,
                        pointBackgroundColor: '#00e1ff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#888' } },
                        x: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#888' } }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        // Feature: Scoring Logic (Core Engine)
        function processBall(runCount) {
            recordHistory();
            matchState.score.runs += runCount;
            matchState.analytics.partnership.r += runCount;

            if(matchState.players.strike === 1) {
                matchState.players.p1.runs += runCount;
                matchState.players.p1.balls++;
            } else {
                matchState.players.p2.runs += runCount;
                matchState.players.p2.balls++;
            }

            matchState.score.balls++;
            matchState.analytics.partnership.b++;

            if(matchState.score.balls >= 6) {
                matchState.score.overs++;
                matchState.score.balls = 0;
                matchState.analytics.graphData.push(matchState.score.runs);
                toggleStrike();
            }

            if(runCount === 1 || runCount === 3) toggleStrike();
            syncToCloud();
        }

        function processWicket() {
            let nextMan = prompt("WICKET FALL! ENTER NEXT BATSMAN NAME:");
            if(nextMan) {
                recordHistory();
                // Record Fall of Wicket
                matchState.analytics.fow.push({
                    w: matchState.score.wkts + 1,
                    r: matchState.score.runs,
                    o: matchState.score.overs + "." + matchState.score.balls,
                    p: matchState.players.strike === 1 ? matchState.players.p1.name : matchState.players.p2.name
                });

                matchState.score.wkts++;
                matchState.analytics.partnership = { r: 0, b: 0 };

                if(matchState.players.strike === 1) {
                    matchState.players.p1 = { name: nextMan.toUpperCase(), runs: 0, balls: 0, img: matchState.players.p1.img };
                } else {
                    matchState.players.p2 = { name: nextMan.toUpperCase(), runs: 0, balls: 0, img: matchState.players.p2.img };
                }
                syncToCloud();
            }
        }

        function processExtra(type) {
            recordHistory();
            matchState.score.runs++;
            if(type === 'LB' || type === 'B') {
                matchState.score.balls++;
                if(matchState.score.balls >= 6) {
                    matchState.score.overs++;
                    matchState.score.balls = 0;
                    matchState.analytics.graphData.push(matchState.score.runs);
                    toggleStrike();
                }
            }
            syncToCloud();
        }

        function toggleStrike() {
            matchState.players.strike = matchState.players.strike === 1 ? 2 : 1;
            syncToCloud();
        }

        // Feature: Professional Undo
        function recordHistory() {
            if(!matchState.history) matchState.history = [];
            matchState.history.push(JSON.parse(JSON.stringify(matchState)));
            if(matchState.history.length > 20) matchState.history.shift();
        }

        function undoStep() {
            if(matchState.history && matchState.history.length > 0) {
                const prevState = matchState.history.pop();
                matchState = prevState;
                syncToCloud();
            } else {
                alert("SYSTEM: NO MORE HISTORY TO REVERT.");
            }
        }

        // UI RENDERERS
        function renderBroadcastUI() {
            document.getElementById('ui-runs').innerText = matchState.score.runs;
            document.getElementById('ui-wkts').innerText = matchState.score.wkts;
            document.getElementById('ui-overs').innerText = matchState.score.overs + "." + matchState.score.balls;
            document.getElementById('ui-team-name').innerText = matchState.teams.batting;
            document.getElementById('ui-tour-name').innerText = matchState.meta.tour;
            
            document.getElementById('ui-p1-name').innerText = matchState.players.p1.name;
            document.getElementById('ui-p1-score').innerText = matchState.players.p1.runs + " (" + matchState.players.p1.balls + ")";
            document.getElementById('ui-p2-name').innerText = matchState.players.p2.name;
            document.getElementById('ui-p2-score').innerText = matchState.players.p2.runs + " (" + matchState.players.p2.balls + ")";
            
            document.getElementById('ui-opp-name').innerText = matchState.teams.bowling;
            document.getElementById('ui-target-val').innerText = "TARGET: " + matchState.score.target;
            document.getElementById('ui-bowler').innerText = matchState.players.bowler;

            // Handle Photo Strike Logic
            const activePhoto = matchState.players.strike === 1 ? matchState.players.p1.img : matchState.players.p2.img;
            document.getElementById('ui-striker-img').src = activePhoto || "https://www.w3schools.com/howto/img_avatar.png";
            
            document.getElementById('row-p1').className = matchState.players.strike === 1 ? "batsman-row active" : "batsman-row";
            document.getElementById('row-p2').className = matchState.players.strike === 2 ? "batsman-row active" : "batsman-row";

            // Render Over Dots
            let dots = "";
            for(let i=1; i<=6; i++) {
                let active = i <= matchState.score.balls ? 'background:var(--primary); box-shadow:0 0 10px var(--primary);' : 'border:1px solid #333';
                dots += `<div style="width:10px; height:10px; border-radius:50%; transition:0.3s; ${active}"></div>`;
            }
            document.getElementById('ui-ball-dots').innerHTML = dots;

            // Render Graph
            if(graphWidget) {
                graphWidget.data.labels = matchState.analytics.graphData.map((_, i) => "OV " + i);
                graphWidget.data.datasets[0].data = matchState.analytics.graphData;
                graphWidget.update();
            }

            // Render FOW
            let fowHtml = "";
            matchState.analytics.fow.forEach(item => {
                fowHtml += `<div style="padding:10px; border-left:3px solid var(--danger); background:rgba(255,0,0,0.05); margin-bottom:10px; border-radius:0 10px 10px 0;">
                    <span style="color:var(--danger); font-weight:900;">${item.w}-${item.r}</span> 
                    <small style="opacity:0.6;">(${item.o} ov) - ${item.p}</small>
                </div>`;
            });
            document.getElementById('ui-fow-list').innerHTML = fowHtml || '<div style="opacity:0.3; text-align:center; margin-top:50px;">NO DATA</div>';
        }

        function renderAdminDashboard() {
            // Stats Calculations
            let totalBalls = (matchState.score.overs * 6) + matchState.score.balls;
            let crr = totalBalls > 0 ? (matchState.score.runs / totalBalls) * 6 : 0;
            document.getElementById('stat-rr').innerText = crr.toFixed(2);
            document.getElementById('stat-proj').innerText = Math.round(crr * 20);
            document.getElementById('stat-pship').innerText = matchState.analytics.partnership.r + "(" + matchState.analytics.partnership.b + ")";
            
            if(matchState.score.target > 0) {
                let remR = matchState.score.target - matchState.score.runs;
                let remB = 120 - totalBalls;
                let rrr = remB > 0 ? (remR / remB) * 6 : 0;
                document.getElementById('stat-rrr').innerText = rrr.toFixed(2);
                document.getElementById('ui-rrr').innerText = "REQ. RATE: " + rrr.toFixed(2);
            }

            // Sync Inputs
            document.getElementById('in-tour').value = matchState.meta.tour;
            document.getElementById('in-team').value = matchState.teams.batting;
            document.getElementById('in-opp-n').value = matchState.teams.bowling;
            document.getElementById('in-target').value = matchState.score.target;
            document.getElementById('in-p1-n').value = matchState.players.p1.name;
            document.getElementById('in-p1-i').value = matchState.players.p1.img;
            document.getElementById('in-p2-n').value = matchState.players.p2.name;
            document.getElementById('in-p2-i').value = matchState.players.p2.img;
            document.getElementById('in-bowler').value = matchState.players.bowler;
        }

        // AUTH & SYNC ENGINE
        function validateAccess() {
            if(document.getElementById('master-key').value === "Chhotu8718") {
                localStorage.setItem("admin_auth", "CLEARED");
                showConsole();
                vibratePhone(100);
            } else {
                alert("ACCESS DENIED: INVALID MASTER KEY.");
            }
        }

        function showConsole() {
            document.getElementById('auth-panel').style.display = "none";
            document.getElementById('master-console').style.display = "block";
        }

        function syncToCloud() {
            // Capture all inputs into state before sync
            matchState.meta.tour = document.getElementById('in-tour').value;
            matchState.teams.batting = document.getElementById('in-team').value;
            matchState.teams.bowling = document.getElementById('in-opp-n').value;
            matchState.score.target = parseInt(document.getElementById('in-target').value) || 0;
            matchState.players.p1.name = document.getElementById('in-p1-n').value;
            matchState.players.p1.img = document.getElementById('in-p1-i').value;
            matchState.players.p2.name = document.getElementById('in-p2-n').value;
            matchState.players.p2.img = document.getElementById('in-p2-i').value;
            matchState.players.bowler = document.getElementById('in-bowler').value;
            
            engineDB.set(matchState);
        }

        function resetMatchEngine() {
            if(confirm("CRITICAL WARNING: This will destroy all current match data. Are you sure?")) {
                matchState = {
                    meta: { tour: "TOURNAMENT 2026", timestamp: Date.now() },
                    score: { runs: 0, wkts: 0, overs: 0, balls: 0, target: 0 },
                    teams: { batting: "TEAM A", bowling: "TEAM B" },
                    players: {
                        p1: { name: "PLAYER 1", runs: 0, balls: 0, img: "" },
                        p2: { name: "PLAYER 2", runs: 0, balls: 0, img: "" },
                        bowler: "READY", strike: 1
                    },
                    analytics: { graphData: [0], fow: [], partnership: { r: 0, b: 0 } },
                    history: []
                };
                syncToCloud();
            }
        }

        function startClock() {
            setInterval(() => {
                document.getElementById('ui-clock').innerText = new Date().toLocaleTimeString();
            }, 1000);
        }

        function vibratePhone(ms) { if(navigator.vibrate) navigator.vibrate(ms); }

    </script>
</body>
</html>
