<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CHHOTU LIVE BROADCAST PRO | MAX ULTRA EDITION 2026</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;900&family=Oswald:wght@400;700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        /* CSS MODULE: BROADCAST DESIGN SYSTEM (Keeping Original Root) */
        :root { 
            --primary: #fec309; 
            --secondary: #00e1ff; 
            --danger: #ff0040; 
            --success: #00c853;
            --bg-dark: #020812; 
            --panel-bg: #0d1526;
            --accent-glow: 0 0 25px rgba(0, 225, 255, 0.4);
            --broadcast-font: 'Orbitron', sans-serif;
            --ui-font: 'Rajdhani', sans-serif;
            /* New Variables for Expansion */
            --glass: rgba(255, 255, 255, 0.03);
            --border-light: rgba(255, 255, 255, 0.1);
        }

        /* Animations (Preserving and Adding More) */
        @keyframes pulse-live { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }
        .live-tag { animation: pulse-live 1.2s infinite; background: var(--danger); padding: 2px 10px; border-radius: 4px; font-size: 11px; font-weight: 900; }
        
        @keyframes slideInUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .anim-up { animation: slideInUp 0.6s ease-out; }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg-dark); color: #fff; font-family: var(--ui-font); margin: 0; padding: 0; overflow-x: hidden; scroll-behavior: smooth; }

        /* --- BROADCAST OVERLAY (Preserving All Layouts) --- */
        .broadcast-wrapper {
            width: 100%; max-width: 1500px; margin: 0 auto; background: #000;
            position: sticky; top: 0; z-index: 9999; border-bottom: 5px solid var(--primary);
            box-shadow: 0 15px 50px rgba(0,0,0,0.9);
        }

        .header-bar {
            height: 45px; background: #000; display: flex; justify-content: space-between;
            align-items: center; padding: 0 30px; font-family: var(--broadcast-font); font-size: 12px;
        }

        .main-scoreboard {
            min-height: 140px; background: linear-gradient(180deg, #00122e 0%, #000 100%);
            display: flex; align-items: center; position: relative; overflow: hidden;
        }

        /* Player Photo Section - NEW FEATURE */
        .photo-container {
            width: 110px; height: 140px; background: #111; border-right: 3px solid var(--primary);
            position: relative; overflow: hidden; flex-shrink: 0;
        }
        .photo-container img { width: 100%; height: 100%; object-fit: cover; filter: contrast(1.1); }
        .photo-overlay { position: absolute; bottom: 0; width: 100%; background: rgba(254, 195, 9, 0.85); color: #000; font-size: 10px; font-weight: 900; text-align: center; padding: 2px 0; }

        .team-block { padding: 0 30px; min-width: 220px; text-align: center; border-right: 1px solid rgba(255,255,255,0.1); }
        .team-name { font-size: 38px; font-weight: 900; font-family: var(--broadcast-font); color: var(--primary); }

        .score-block { padding: 0 40px; display: flex; align-items: baseline; gap: 10px; }
        .runs { font-size: 85px; font-weight: 900; font-family: var(--broadcast-font); text-shadow: var(--accent-glow); }
        .wkts { font-size: 60px; color: #777; font-weight: 900; }
        .overs { font-size: 28px; color: var(--secondary); font-weight: 700; margin-left: 15px; }

        .batsmen-live { flex-grow: 1; padding: 0 30px; }
        .b-row { display: flex; justify-content: space-between; font-size: 20px; padding: 8px 15px; border-radius: 8px; margin: 5px 0; border: 1px solid transparent; transition: 0.3s; }
        .b-active { background: rgba(0, 225, 255, 0.1); border-color: var(--secondary); color: var(--secondary); font-weight: 700; box-shadow: inset 0 0 10px rgba(0,225,255,0.1); }
        .b-name { font-family: var(--broadcast-font); text-transform: uppercase; font-size: 16px; }

        .opp-mini-card {
            background: rgba(255,255,255,0.05); height: 140px; min-width: 280px;
            display: flex; flex-direction: column; justify-content: center; padding: 0 25px;
            border-left: 4px solid var(--secondary);
        }

        /* --- GRAPH & TIMELINE SECTION --- */
        .visual-panel {
            max-width: 1500px; margin: 20px auto; display: grid; grid-template-columns: 2fr 1fr; gap: 20px; padding: 0 20px;
        }
        .graph-card { background: var(--panel-bg); border-radius: 20px; padding: 25px; border: 1px solid var(--border-light); }
        .wicket-timeline { background: var(--panel-bg); border-radius: 20px; padding: 25px; border: 1px solid var(--border-light); }
        .timeline-item { border-left: 2px solid var(--danger); padding: 10px 15px; margin-bottom: 10px; background: rgba(255,0,64,0.05); border-radius: 0 10px 10px 0; }

        /* --- ADMIN DASHBOARD (Extended) --- */
        .admin-main { padding: 40px 20px; max-width: 1500px; margin: 0 auto; }
        .glass-card { background: var(--panel-bg); border-radius: 25px; padding: 35px; border: 1px solid var(--border-light); margin-bottom: 30px; box-shadow: 0 20px 40px rgba(0,0,0,0.5); }
        
        .grid-layout { display: grid; grid-template-columns: 1.2fr 1fr 1fr; gap: 30px; }
        .btn-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; }

        button {
            padding: 18px; border: none; border-radius: 15px; font-weight: 900; font-family: var(--ui-font);
            text-transform: uppercase; cursor: pointer; transition: 0.2s; box-shadow: 0 5px 0 rgba(0,0,0,0.3);
        }
        button:active { transform: translateY(3px); box-shadow: 0 2px 0 rgba(0,0,0,0.3); }

        .btn-run { background: #1a73e8; color: #fff; }
        .btn-bound { background: var(--primary); color: #000; }
        .btn-out { background: var(--danger); color: #fff; }
        .btn-special { background: var(--success); color: #fff; height: 100px; font-size: 24px; }
        .btn-reset { background: #333; color: #fff; }

        input {
            width: 100%; background: #050b17; border: 2px solid #1a2a44; color: #fff;
            padding: 14px; border-radius: 12px; margin-bottom: 15px; font-family: var(--ui-font);
            transition: 0.3s;
        }
        input:focus { border-color: var(--secondary); outline: none; }

        .stat-box { background: #01060d; padding: 20px; border-radius: 15px; border-bottom: 4px solid var(--primary); text-align: center; }
        .stat-val { font-size: 30px; font-weight: 900; font-family: var(--broadcast-font); color: var(--secondary); }

        /* Mobile Adjustments */
        @media (max-width: 1000px) {
            .grid-layout, .visual-panel { grid-template-columns: 1fr; }
            .main-scoreboard { flex-direction: column; height: auto; }
            .photo-container { width: 100%; height: 180px; border-right: none; border-bottom: 3px solid var(--primary); }
            .opp-mini-card { width: 100%; border-left: none; border-top: 4px solid var(--secondary); }
            .score-block { padding: 20px; }
            .runs { font-size: 60px; }
        }
    </style>
</head>
<body onload="startup()">

    <div class="broadcast-wrapper">
        <div class="header-bar">
            <div><span class="live-tag">LIVE</span> <span id="disp-tour">PREMIER LEAGUE 2026</span></div>
            <div id="disp-time">00:00:00</div>
        </div>

        <div class="main-scoreboard">
            <div class="photo-container" id="ui-p-photo-box">
                <img id="disp-p-img" src="https://www.w3schools.com/howto/img_avatar.png" alt="Player">
                <div class="photo-overlay">ON STRIKE</div>
            </div>

            <div class="team-block">
                <div style="font-size: 10px; letter-spacing: 2px; opacity: 0.6;">BATTING</div>
                <div class="team-name" id="disp-team">TEAM A</div>
            </div>

            <div class="score-block">
                <span class="runs" id="disp-runs">0</span>
                <span class="wkts">/<span id="disp-wkts">0</span></span>
                <span class="overs" id="disp-overs">0.0</span>
            </div>

            <div class="batsmen-live">
                <div class="b-row" id="row-p1">
                    <span class="b-name" id="disp-p1-n">PLAYER 1</span>
                    <span id="disp-p1-s">0(0)</span>
                </div>
                <div class="b-row" id="row-p2">
                    <span class="b-name" id="disp-p2-n">PLAYER 2</span>
                    <span id="disp-p2-s">0(0)</span>
                </div>
            </div>

            <div class="opp-mini-card">
                <div style="font-size: 11px; color: var(--secondary); font-weight: 900;">OPPONENT INFO</div>
                <div style="font-size: 24px; font-weight: 900; font-family: var(--broadcast-font);" id="disp-opp-n">OPPONENT</div>
                <div style="font-size: 20px; font-weight: 700;" id="disp-opp-s">0-0 (0.0)</div>
                <div style="font-size: 12px; margin-top: 5px; color: var(--primary);">TARGET: <span id="disp-target">0</span></div>
            </div>
        </div>
        
        <div style="height: 40px; background: #000; border-top: 1px solid #222; display: flex; align-items: center; padding: 0 30px; justify-content: space-between;">
            <div style="font-size: 13px; color: #888; font-weight: 900;">
                CURRENT BOWLER: <span id="disp-bowler" style="color: var(--primary);">AWAITING</span>
            </div>
            <div style="display: flex; gap: 10px;" id="disp-dots">
                </div>
        </div>
    </div>

    <div class="visual-panel">
        <div class="graph-card anim-up">
            <h3 style="margin:0 0 15px 0; font-family: var(--broadcast-font); color: var(--secondary); font-size: 14px;">WORM GRAPH: RUN PROGRESSION</h3>
            <div style="height: 250px; width: 100%;">
                <canvas id="wormChart"></canvas>
            </div>
        </div>
        <div class="wicket-timeline anim-up" style="animation-delay: 0.2s;">
            <h3 style="margin:0 0 15px 0; font-family: var(--broadcast-font); color: var(--danger); font-size: 14px;">FALL OF WICKETS</h3>
            <div id="disp-fow" style="max-height: 250px; overflow-y: auto;">
                <div class="timeline-item" style="border-color: #333; background: transparent;">NO WICKETS YET</div>
            </div>
        </div>
    </div>

    <div class="admin-main">
        
        <div id="login-box" class="glass-card" style="max-width: 500px; margin: 0 auto; text-align: center;">
            <h2 style="font-family: var(--broadcast-font); color: var(--primary);">MASTER ACCESS</h2>
            <p style="opacity:0.5; font-size: 14px;">ENTER ENCRYPTION KEY TO ENABLE CONSOLE</p>
            <input type="password" id="m-key" placeholder="••••••••" style="text-align: center; font-size: 24px; letter-spacing: 8px; margin: 20px 0;">
            <button class="btn-bound" style="width: 100%;" onclick="checkAuth()">UNLOCK ENGINE</button>
        </div>

        <div id="admin-ui" style="display: none;" class="anim-up">
            <div class="grid-layout">
                
                <div class="glass-card">
                    <h3 style="color: var(--primary); margin:0 0 20px 0; border-bottom: 1px solid #333; padding-bottom: 10px;">LIVE CONSOLE</h3>
                    
                    <button class="btn-special" onclick="addBall(0)" style="width: 100%; margin-bottom: 15px;">DOT BALL (0)</button>
                    
                    <div class="btn-grid" style="margin-bottom: 15px;">
                        <button class="btn-run" onclick="addBall(1)">+1</button>
                        <button class="btn-run" onclick="addBall(2)">+2</button>
                        <button class="btn-run" onclick="addBall(3)">+3</button>
                        <button class="btn-reset" onclick="undoLast()">UNDO</button>
                    </div>

                    <div class="btn-grid" style="margin-bottom: 15px;">
                        <button class="btn-bound" onclick="addBall(4)">FOUR</button>
                        <button class="btn-bound" onclick="addBall(6)">SIX</button>
                        <button class="btn-out" onclick="wicketFall()" style="grid-column: span 2;">WICKET</button>
                    </div>

                    <div class="btn-grid">
                        <button class="btn-run" style="background: #222;" onclick="extraRun('WD')">WD</button>
                        <button class="btn-run" style="background: #222;" onclick="extraRun('NB')">NB</button>
                        <button class="btn-run" style="background: #222;" onclick="extraRun('LB')">LB</button>
                        <button class="btn-run" style="background: #222;" onclick="swapStrike()">SWAP</button>
                    </div>
                </div>

                <div class="glass-card">
                    <h3 style="color: var(--secondary); margin:0 0 20px 0; border-bottom: 1px solid #333; padding-bottom: 10px;">MATCH DATA</h3>
                    <label style="font-size: 11px; color: var(--secondary);">TOURNAMENT</label>
                    <input type="text" id="in-tour" oninput="syncAll()">
                    
                    <label style="font-size: 11px; color: var(--secondary);">BATTING TEAM</label>
                    <input type="text" id="in-team" oninput="syncAll()">
                    
                    <label style="font-size: 11px; color: var(--secondary);">OPPONENT NAME</label>
                    <input type="text" id="in-opp-n" oninput="syncAll()">
                    
                    <label style="font-size: 11px; color: var(--secondary);">OPPONENT SCORE</label>
                    <input type="text" id="in-opp-s" oninput="syncAll()" placeholder="e.g. 145/6 (20.0)">
                    
                    <label style="font-size: 11px; color: var(--secondary);">TARGET</label>
                    <input type="number" id="in-target" oninput="syncAll()">
                </div>

                <div class="glass-card">
                    <h3 style="color: var(--success); margin:0 0 20px 0; border-bottom: 1px solid #333; padding-bottom: 10px;">MEDIA ENGINE</h3>
                    
                    <label style="font-size: 11px; color: var(--success);">STRIKER NAME</label>
                    <input type="text" id="in-p1" oninput="syncAll()">
                    
                    <label style="font-size: 11px; color: var(--success);">STRIKER IMAGE (URL)</label>
                    <input type="text" id="in-p1-img" oninput="syncAll()" placeholder="Paste image link here">
                    
                    <label style="font-size: 11px; color: var(--success);">NON-STRIKER NAME</label>
                    <input type="text" id="in-p2" oninput="syncAll()">
                    
                    <label style="font-size: 11px; color: var(--success);">NON-STRIKER IMAGE (URL)</label>
                    <input type="text" id="in-p2-img" oninput="syncAll()">
                    
                    <label style="font-size: 11px; color: var(--success);">CURRENT BOWLER</label>
                    <input type="text" id="in-bowler" oninput="syncAll()">
                </div>
            </div>

            <div class="glass-card">
                <h3 style="color: #fff; margin-bottom: 25px;">LIVE PERFORMANCE DATA</h3>
                <div class="btn-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                    <div class="stat-box">
                        <div style="font-size: 11px; opacity: 0.5;">CURRENT RUN RATE</div>
                        <div class="stat-val" id="st-rr">0.00</div>
                    </div>
                    <div class="stat-box" style="border-color: var(--secondary);">
                        <div style="font-size: 11px; opacity: 0.5;">REQ. RUN RATE</div>
                        <div class="stat-val" id="st-rrr">0.00</div>
                    </div>
                    <div class="stat-box" style="border-color: var(--success);">
                        <div style="font-size: 11px; opacity: 0.5;">PROJECTED SCORE</div>
                        <div class="stat-val" id="st-proj">0</div>
                    </div>
                    <div class="stat-box" style="border-color: var(--danger);">
                        <div style="font-size: 11px; opacity: 0.5;">PARTNERSHIP</div>
                        <div class="stat-val" id="st-pship">0(0)</div>
                    </div>
                </div>
                <div style="margin-top: 30px; display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <button class="btn-run" style="background:#444" onclick="exportData()">EXPORT LOGS</button>
                    <button class="btn-out" onclick="fullReset()">DESTRUCTIVE HARD RESET</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        /* CORE ENGINE LOGIC - EXTENDED V2026
           -------------------------------------------------- 
        */
        const firebaseConfig = { databaseURL: "https://myscoreboard-b140f-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database().ref("broadcast_ultra_max_v2");

        // Initial State (Ensuring all original fields are here + New fields)
        let state = {
            runs: 0, wkts: 0, overs: 0, balls: 0,
            team: "TEAM A", tour: "PREMIER LEAGUE",
            p1: { n: "PLAYER 1", r: 0, b: 0, img: "https://www.w3schools.com/howto/img_avatar.png" },
            p2: { n: "PLAYER 2", r: 0, b: 0, img: "https://www.w3schools.com/howto/img_avatar2.png" },
            strike: 1, bowler: "READY",
            oppN: "OPPONENT", oppS: "0-0 (0.0)", target: 0,
            graph: [0], pship: { r: 0, b: 0 },
            fow: [], // Fall of Wicket History
            history: [] // For Undo
        };

        let wormChart;

        function startup() {
            initGraph();
            if(localStorage.getItem("pro_auth") === "true") showAdmin();
            
            db.on('value', snap => {
                if(snap.val()) {
                    state = snap.val();
                    updateUI();
                    updateAdmin();
                }
            });

            setInterval(() => {
                document.getElementById('disp-time').innerText = new Date().toLocaleTimeString();
            }, 1000);
        }

        function initGraph() {
            const ctx = document.getElementById('wormChart').getContext('2d');
            wormChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: state.graph.map((_, i) => "OV " + i),
                    datasets: [{
                        label: 'Total Runs',
                        data: state.graph,
                        borderColor: '#00e1ff',
                        backgroundColor: 'rgba(0, 225, 255, 0.1)',
                        fill: true,
                        tension: 0.4,
                        borderWidth: 4,
                        pointRadius: 4,
                        pointBackgroundColor: '#fec309'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#888', font: { family: 'Rajdhani' } } },
                        x: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#888', font: { family: 'Rajdhani' } } }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        function addBall(r) {
            vibrate(50);
            // Save history for undo
            state.history.push(JSON.parse(JSON.stringify(state)));
            if(state.history.length > 10) state.history.shift();

            state.runs += r;
            state.pship.r += r;
            
            if(state.strike === 1) { state.p1.r += r; state.p1.b++; }
            else { state.p2.r += r; state.p2.b++; }
            
            state.balls++;
            state.pship.b++;
            
            if(state.balls >= 6) {
                state.overs++;
                state.balls = 0;
                state.graph.push(state.runs); // Auto point in graph per over
                swapStrike();
            }

            if(r === 1 || r === 3) swapStrike();
            save();
        }

        function extraRun(type) {
            state.runs++;
            if(type === 'NB' || type === 'WD') {
                // Ball not counted in over
            } else {
                state.balls++; // LB/B counted
                if(state.balls >= 6) { state.overs++; state.balls = 0; state.graph.push(state.runs); swapStrike(); }
            }
            save();
        }

        function wicketFall() {
            let n = prompt("OUT! ENTER NEW BATSMAN NAME:");
            if(n) {
                // Record Fall of Wicket
                state.fow.push({
                    w: state.wkts + 1,
                    r: state.runs,
                    ov: state.overs + "." + state.balls,
                    name: state.strike === 1 ? state.p1.n : state.p2.n
                });

                state.wkts++;
                state.pship = { r: 0, b: 0 };
                if(state.strike === 1) {
                    state.p1 = { n: n.toUpperCase(), r: 0, b: 0, img: state.p1.img };
                } else {
                    state.p2 = { n: n.toUpperCase(), r: 0, b: 0, img: state.p2.img };
                }
                save();
            }
        }

        function swapStrike() { state.strike = state.strike === 1 ? 2 : 1; save(); }

        function undoLast() {
            if(state.history && state.history.length > 0) {
                state = state.history.pop();
                save();
            } else { alert("Nothing to undo!"); }
        }

        function save() { db.set(state); }

        function syncAll() {
            state.tour = document.getElementById('in-tour').value;
            state.team = document.getElementById('in-team').value;
            state.oppN = document.getElementById('in-opp-n').value;
            state.oppS = document.getElementById('in-opp-s').value;
            state.target = parseInt(document.getElementById('in-target').value) || 0;
            state.p1.n = document.getElementById('in-p1').value;
            state.p1.img = document.getElementById('in-p1-img').value;
            state.p2.n = document.getElementById('in-p2').value;
            state.p2.img = document.getElementById('in-p2-img').value;
            state.bowler = document.getElementById('in-bowler').value;
            save();
        }

        function updateUI() {
            // Text Displays
            document.getElementById('disp-runs').innerText = state.runs;
            document.getElementById('disp-wkts').innerText = state.wkts;
            document.getElementById('disp-overs').innerText = state.overs + "." + state.balls;
            document.getElementById('disp-team').innerText = state.team;
            document.getElementById('disp-tour').innerText = state.tour;
            document.getElementById('disp-p1-n').innerText = state.p1.n;
            document.getElementById('disp-p1-s').innerText = state.p1.r + "(" + state.p1.b + ")";
            document.getElementById('disp-p2-n').innerText = state.p2.n;
            document.getElementById('disp-p2-s').innerText = state.p2.r + "(" + state.p2.b + ")";
            document.getElementById('disp-opp-n').innerText = state.oppN;
            document.getElementById('disp-opp-s').innerText = state.oppS;
            document.getElementById('disp-target').innerText = state.target;
            document.getElementById('disp-bowler').innerText = state.bowler;

            // Image & Strike Engine
            const currentImg = state.strike === 1 ? state.p1.img : state.p2.img;
            document.getElementById('disp-p-img').src = currentImg || "https://www.w3schools.com/howto/img_avatar.png";
            
            document.getElementById('row-p1').className = state.strike === 1 ? "b-row b-active" : "b-row";
            document.getElementById('row-p2').className = state.strike === 2 ? "b-row b-active" : "b-row";

            // Over Dots Generator
            let dHtml = "";
            for(let i=1; i<=6; i++) {
                let clr = i <= state.balls ? 'background:var(--primary); box-shadow: 0 0 10px var(--primary);' : 'border:1px solid #333';
                dHtml += `<div style="width:12px; height:12px; border-radius:50%; transition: 0.3s; ${clr}"></div>`;
            }
            document.getElementById('disp-dots').innerHTML = dHtml;

            // Graph Update
            if(wormChart) {
                wormChart.data.labels = state.graph.map((_, i) => "OV " + i);
                wormChart.data.datasets[0].data = state.graph;
                wormChart.update();
            }

            // Fall of Wicket UI
            let fowHtml = "";
            if(!state.fow || state.fow.length === 0) {
                fowHtml = `<div class="timeline-item" style="border-color: #333; background: transparent;">NO WICKETS YET</div>`;
            } else {
                state.fow.forEach(item => {
                    fowHtml += `<div class="timeline-item">
                        <strong style="color:var(--danger)">${item.w}-${item.r}</strong> 
                        <span style="font-size:12px; opacity:0.7"> (${item.ov} ov) </span><br>
                        <small>${item.name}</small>
                    </div>`;
                });
            }
            document.getElementById('disp-fow').innerHTML = fowHtml;
        }

        function updateAdmin() {
            // Sync Input fields with firebase state
            document.getElementById('in-tour').value = state.tour;
            document.getElementById('in-team').value = state.team;
            document.getElementById('in-p1').value = state.p1.n;
            document.getElementById('in-p1-img').value = state.p1.img;
            document.getElementById('in-p2').value = state.p2.n;
            document.getElementById('in-p2-img').value = state.p2.img;
            document.getElementById('in-opp-n').value = state.oppN;
            document.getElementById('in-opp-s').value = state.oppS;
            document.getElementById('in-target').value = state.target;
            document.getElementById('in-bowler').value = state.bowler;

            // Calculations
            let totalB = (state.overs * 6) + state.balls;
            let rr = totalB > 0 ? (state.runs / totalB) * 6 : 0;
            document.getElementById('st-rr').innerText = rr.toFixed(2);
            document.getElementById('st-proj').innerText = Math.round(rr * 20);
            document.getElementById('st-pship').innerText = state.pship.r + "(" + state.pship.b + ")";
            
            if(state.target > 0) {
                let remainingRuns = state.target - state.runs;
                let remainingBalls = 120 - totalB; // Assuming T20
                let rrr = remainingBalls > 0 ? (remainingRuns / remainingBalls) * 6 : 0;
                document.getElementById('st-rrr').innerText = rrr.toFixed(2);
            }
        }

        function checkAuth() {
            if(document.getElementById('m-key').value === "Chhotu8718") {
                localStorage.setItem("pro_auth", "true");
                showAdmin();
                vibrate([100, 50, 100]);
            } else { alert("ENCRYPTION KEY MISMATCH!"); }
        }

        function showAdmin() {
            document.getElementById('login-box').style.display = "none";
            document.getElementById('admin-ui').style.display = "block";
        }

        function vibrate(ms) { if(navigator.vibrate) navigator.vibrate(ms); }

        function fullReset() {
            if(confirm("DANGER! This will wipe ALL match data, including history and graph. Continue?")) {
                db.set({
                    runs: 0, wkts: 0, overs: 0, balls: 0, team: "TEAM A", tour: "LEAGUE 2026",
                    p1: { n: "PLAYER 1", r: 0, b: 0, img: "" },
                    p2: { n: "PLAYER 2", r: 0, b: 0, img: "" },
                    strike: 1, bowler: "READY", oppN: "OPPONENT", oppS: "0-0", target: 0,
                    graph: [0], pship: { r: 0, b: 0 }, fow: [], history: []
                });
            }
        }

        function exportData() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(state));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href",     dataStr);
            downloadAnchorNode.setAttribute("download", "match_log_" + Date.now() + ".json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }
    </script>
</body>
</html>
