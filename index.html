<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CPL TITAN | PROFESSIONAL BROADCAST DASHBOARD</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Rajdhani:wght@300;400;500;600;700&family=Roboto+Mono:wght@100;300;400;700&display=swap" rel="stylesheet">

    <style>
        /* SECTION 1.1: MASSIVE VARIABLE DECLARATION 
           यहाँ हमने हर एक छोटी चीज़ के लिए अलग वेरिएबल बनाया है ताकि कोडिंग का विस्तार हो सके।
        */
        :root {
            --cpl-main-bg: #01040a;
            --cpl-panel-dark: #0d1117;
            --cpl-panel-light: #161b22;
            --cpl-accent-yellow: #fec301;
            --cpl-accent-blue: #00d2ff;
            --cpl-accent-red: #ff3e3e;
            --cpl-accent-green: #00ff87;
            --cpl-text-primary: #f0f6fc;
            --cpl-text-secondary: #8b949e;
            --cpl-border-default: #30363d;
            --cpl-glow-yellow: 0 0 20px rgba(254, 195, 1, 0.3);
            --cpl-glow-blue: 0 0 20px rgba(0, 210, 255, 0.3);
            --cpl-font-broadcast: 'Orbitron', sans-serif;
            --cpl-font-ui: 'Rajdhani', sans-serif;
            --cpl-font-mono: 'Roboto Mono', monospace;
            --cpl-header-height: 140px;
            --cpl-transition-smooth: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* SECTION 1.2: GLOBAL RESET & SCROLLBAR ENGINE */
        * {
            margin: 0; padding: 0; box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--cpl-main-bg); }
        ::-webkit-scrollbar-thumb { background: var(--cpl-border-default); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--cpl-accent-yellow); }

        body {
            background-color: var(--cpl-main-bg);
            color: var(--cpl-text-primary);
            font-family: var(--cpl-font-ui);
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 0% 0%, rgba(0, 210, 255, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 100% 100%, rgba(254, 195, 1, 0.05) 0%, transparent 50%);
        }

        /* SECTION 1.3: BROADCAST OVERLAY ARCHITECTURE (THE TOP BAR) */
        .titan-broadcast-overlay {
            width: 100%;
            background: #000;
            position: sticky;
            top: 0;
            z-index: 10000;
            border-bottom: 5px solid var(--cpl-accent-yellow);
            box-shadow: 0 10px 50px rgba(0,0,0,0.8);
        }

        .broadcast-top-meta {
            height: 35px;
            background: linear-gradient(90deg, #000 0%, #111 100%);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 40px;
            font-family: var(--cpl-font-broadcast);
            font-size: 12px;
            letter-spacing: 2px;
            color: var(--cpl-accent-yellow);
            border-bottom: 1px solid #222;
        }

        .main-score-engine-wrap {
            display: grid;
            grid-template-columns: 22% 48% 30%;
            height: 105px;
            overflow: hidden;
        }

        .batting-team-logo-box {
            background: var(--cpl-accent-yellow);
            color: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            clip-path: polygon(0 0, 100% 0, 85% 100%, 0 100%);
            position: relative;
        }

        .team-name-heavy {
            font-family: var(--cpl-font-broadcast);
            font-size: 42px;
            font-weight: 900;
            text-transform: uppercase;
            text-shadow: 2px 2px 0px rgba(255,255,255,0.2);
        }

        .live-score-central {
            background: linear-gradient(135deg, #050d1a 0%, #0d1117 100%);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            border-right: 1px solid #333;
        }

        .score-display-huge {
            display: flex;
            align-items: baseline;
            gap: 15px;
        }

        .runs-wickets {
            font-family: var(--cpl-font-broadcast);
            font-size: 65px;
            font-weight: 900;
            color: #fff;
            filter: drop-shadow(0 0 10px rgba(255,255,255,0.1));
        }

        .overs-sub-text {
            font-family: var(--cpl-font-broadcast);
            font-size: 24px;
            color: var(--cpl-text-secondary);
        }

        .active-players-mini {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-width: 220px;
        }

        .player-row-mini {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 15px;
            background: rgba(255,255,255,0.02);
            border-radius: 6px;
            transition: var(--cpl-transition-smooth);
            border-left: 0px solid var(--cpl-accent-yellow);
        }

        .player-row-mini.on-strike {
            background: rgba(254, 195, 1, 0.1);
            border-left-width: 5px;
            color: var(--cpl-accent-yellow);
            box-shadow: inset 10px 0 20px rgba(254, 195, 1, 0.05);
        }

        .opponent-status-engine {
            background: #0d1117;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: flex-end;
            padding-right: 40px;
            position: relative;
        }

        .target-ribbon {
            background: var(--cpl-accent-blue);
            color: #000;
            padding: 2px 15px;
            font-weight: 800;
            font-size: 14px;
            clip-path: polygon(10% 0, 100% 0, 100% 100%, 0 100%);
            margin-bottom: 5px;
        }

        /* SECTION 1.4: BALL-BY-BALL TRACKER UI */
        .over-tracker-bar {
            background: #000;
            height: 40px;
            border-top: 1px solid #222;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 40px;
        }

        .bowler-info-tag {
            font-size: 14px;
            font-weight: 600;
            color: var(--cpl-text-secondary);
        }

        .bowler-info-tag span { color: var(--cpl-accent-yellow); margin-left: 10px; font-family: var(--cpl-font-broadcast); }

        .balls-sequence-wrap {
            display: flex;
            gap: 12px;
        }

        .ball-unit {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: #1c2128;
            border: 1px solid #30363d;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: var(--cpl-font-broadcast);
            font-size: 12px;
            font-weight: 700;
            transition: var(--cpl-transition-smooth);
        }

        .ball-unit.active-ball {
            background: var(--cpl-accent-yellow);
            color: #000;
            box-shadow: var(--cpl-glow-yellow);
            border-color: #fff;
            transform: scale(1.1);
        }

        /* SECTION 1.5: DASHBOARD CONTAINER LAYOUT */
        .titan-main-wrapper {
            max-width: 1600px;
            margin: 30px auto;
            padding: 0 30px;
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
        }

        /* Responsive Breakpoints (Massive) */
        @media (max-width: 1200px) {
            .titan-main-wrapper { grid-template-columns: 1fr; }
            .main-score-engine-wrap { grid-template-columns: 1fr; height: auto; }
            .batting-team-logo-box { clip-path: none; padding: 20px; }
            .opponent-status-engine { align-items: center; padding: 20px; }
        }
    </style>
</head>

<body>
    <div class="titan-broadcast-overlay">
        <div class="broadcast-top-meta">
            <div id="ui-tour-display">BAGREKASA PREMIER LEAGUE | SEASON 2026</div>
            <div>LIVE STREAMING <span id="ui-clock" style="color:#fff; margin-left:15px;">00:00:00</span></div>
        </div>

        <div class="main-score-engine-wrap">
            <div class="batting-team-logo-box">
                <span class="team-name-heavy" id="ui-team-a">TEAM A</span>
            </div>

            <div class="live-score-central">
                <div class="score-display-huge">
                    <span class="runs-wickets" id="ui-score">0 - 0</span>
                    <span class="overs-sub-text" id="ui-overs">(0.0)</span>
                </div>

                <div class="active-players-mini">
                    <div class="player-row-mini on-strike" id="ui-p1-row">
                        <span id="ui-p1-name">STRIKER</span>
                        <span id="ui-p1-stats">0 (0)</span>
                    </div>
                    <div class="player-row-mini" id="ui-p2-row">
                        <span id="ui-p2-name">NON-STRIKER</span>
                        <span id="ui-p2-stats">0 (0)</span>
                    </div>
                </div>
            </div>

            <div class="opponent-status-engine">
                <div class="target-ribbon" id="ui-target-box">TARGET: 0</div>
                <div style="font-size: 28px; font-weight: 900; font-family: var(--cpl-font-broadcast);" id="ui-opp-sum">0-0 (0.0)</div>
                <div style="font-size: 11px; color: var(--cpl-accent-blue); letter-spacing: 2px;">OPPONENT INNINGS</div>
            </div>
        </div>

        <div class="over-tracker-bar">
            <div class="bowler-info-tag">CURRENT BOWLER: <span id="ui-bowler">NOT ASSIGNED</span></div>
            <div class="balls-sequence-wrap" id="ui-ball-dots">
                <div class="ball-unit">1</div>
                <div class="ball-unit">2</div>
                <div class="ball-unit">3</div>
                <div class="ball-unit">4</div>
                <div class="ball-unit">5</div>
                <div class="ball-unit">6</div>
            </div>
        </div>
    </div>

    <div class="titan-main-wrapper" id="titan-dashboard-root">
                <section class="command-center-module" style="display: flex; flex-direction: column; gap: 25px;">
            
            <div class="titan-panel-card" style="background: var(--cpl-panel-dark); border-radius: 20px; padding: 30px; border: 1px solid var(--cpl-border-default); box-shadow: 0 20px 40px rgba(0,0,0,0.4);">
                
                <div class="panel-header-flex" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; border-bottom: 1px solid #333; padding-bottom: 15px;">
                    <h2 style="font-family: var(--cpl-font-broadcast); font-size: 16px; color: var(--cpl-accent-yellow); letter-spacing: 2px;">SCORING COMMAND INTERFACE</h2>
                    <div style="font-family: var(--cpl-font-mono); font-size: 12px; color: var(--cpl-accent-green);">SYSTEM STATUS: OPERATIONAL</div>
                </div>

                <button class="titan-btn btn-huge-dot" onclick="processDelivery(0, 'DOT')" 
                    style="width: 100%; height: 100px; background: var(--cpl-accent-green); color: #000; border: none; border-radius: 15px; font-family: var(--cpl-font-broadcast); font-size: 28px; font-weight: 900; cursor: pointer; transition: var(--cpl-transition-smooth); margin-bottom: 20px; display: flex; align-items: center; justify-content: center; gap: 15px; box-shadow: 0 10px 0px #00a859;">
                    <span style="font-size: 40px;">●</span> NEXT BALL (DOT)
                </button>

                <div class="scoring-grid-layout" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px;">
                    
                    <button class="titan-btn btn-run" onclick="processDelivery(1, 'SINGLE')" 
                        style="height: 70px; background: var(--cpl-accent-blue); border: none; border-radius: 12px; color: #fff; font-family: var(--cpl-font-broadcast); font-size: 20px; font-weight: 700; cursor: pointer; transition: var(--cpl-transition-smooth); box-shadow: 0 6px 0px #008eb4;">+1 RUN</button>
                    
                    <button class="titan-btn btn-run" onclick="processDelivery(2, 'DOUBLE')" 
                        style="height: 70px; background: var(--cpl-accent-blue); border: none; border-radius: 12px; color: #fff; font-family: var(--cpl-font-broadcast); font-size: 20px; font-weight: 700; cursor: pointer; transition: var(--cpl-transition-smooth); box-shadow: 0 6px 0px #008eb4;">+2 RUNS</button>
                    
                    <button class="titan-btn btn-run" onclick="processDelivery(3, 'TRIPLE')" 
                        style="height: 70px; background: var(--cpl-accent-blue); border: none; border-radius: 12px; color: #fff; font-family: var(--cpl-font-broadcast); font-size: 20px; font-weight: 700; cursor: pointer; transition: var(--cpl-transition-smooth); box-shadow: 0 6px 0px #008eb4;">+3 RUNS</button>

                    <button class="titan-btn btn-undo" onclick="executeUndo()" 
                        style="height: 70px; background: #30363d; border: none; border-radius: 12px; color: #fff; font-family: var(--cpl-font-broadcast); font-size: 16px; font-weight: 700; cursor: pointer; transition: var(--cpl-transition-smooth); box-shadow: 0 6px 0px #1c2128;">UNDO / ERASE</button>

                    <button class="titan-btn btn-four" onclick="processDelivery(4, 'BOUNDARY')" 
                        style="height: 70px; background: var(--cpl-accent-yellow); border: none; border-radius: 12px; color: #000; font-family: var(--cpl-font-broadcast); font-size: 24px; font-weight: 900; cursor: pointer; transition: var(--cpl-transition-smooth); box-shadow: 0 6px 0px #b38a00;">FOUR (4)</button>
                    
                    <button class="titan-btn btn-six" onclick="processDelivery(6, 'SIXER')" 
                        style="height: 70px; background: var(--cpl-accent-yellow); border: none; border-radius: 12px; color: #000; font-family: var(--cpl-font-broadcast); font-size: 24px; font-weight: 900; cursor: pointer; transition: var(--cpl-transition-smooth); box-shadow: 0 6px 0px #b38a00;">SIX (6)</button>

                    <button class="titan-btn btn-wicket" onclick="triggerDismissal()" 
                        style="height: 70px; grid-column: span 2; background: var(--cpl-accent-red); border: none; border-radius: 12px; color: #fff; font-family: var(--cpl-font-broadcast); font-size: 22px; font-weight: 900; cursor: pointer; transition: var(--cpl-transition-smooth); box-shadow: 0 6px 0px #b30000; display: flex; align-items: center; justify-content: center; gap: 10px;">
                        OUT / WICKET
                    </button>

                    <button class="titan-btn btn-extra" onclick="processExtra('WD')" 
                        style="height: 60px; background: #21262d; border: 1px solid #444; border-radius: 10px; color: var(--cpl-accent-blue); font-family: var(--cpl-font-broadcast); font-size: 16px; font-weight: 700; cursor: pointer;">WIDE</button>
                    
                    <button class="titan-btn btn-extra" onclick="processExtra('NB')" 
                        style="height: 60px; background: #21262d; border: 1px solid #444; border-radius: 10px; color: var(--cpl-accent-blue); font-family: var(--cpl-font-broadcast); font-size: 16px; font-weight: 700; cursor: pointer;">NO BALL</button>
                    
                    <button class="titan-btn btn-extra" onclick="processExtra('LB')" 
                        style="height: 60px; background: #21262d; border: 1px solid #444; border-radius: 10px; color: var(--cpl-accent-blue); font-family: var(--cpl-font-broadcast); font-size: 16px; font-weight: 700; cursor: pointer;">LEG BYE</button>

                    <button class="titan-btn btn-extra" onclick="manualStrikeChange()" 
                        style="height: 60px; background: #000; border: 1px solid var(--cpl-accent-yellow); border-radius: 10px; color: var(--cpl-accent-yellow); font-family: var(--cpl-font-broadcast); font-size: 14px; font-weight: 700; cursor: pointer;">SWAP STRIKE</button>
                </div>

                <button class="titan-btn btn-innings-swap" onclick="advancedInningsSwitch()" 
                    style="width: 100%; height: 60px; margin-top: 25px; background: linear-gradient(90deg, #111 0%, #222 100%); border: 1px solid #333; border-radius: 12px; color: #8b949e; font-family: var(--cpl-font-broadcast); font-size: 14px; letter-spacing: 3px; cursor: pointer; transition: var(--cpl-transition-smooth);">
                    ADVANCED: SWITCH INNINGS / END MATCH
                </button>
            </div>

            <div class="analytics-widgets-grid" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px;">
                
                <div class="stat-card-neo" style="background: var(--cpl-panel-dark); padding: 20px; border-radius: 15px; border-bottom: 3px solid var(--cpl-accent-yellow); text-align: center;">
                    <div style="font-size: 10px; color: var(--cpl-text-secondary); margin-bottom: 5px; letter-spacing: 1px;">CURRENT PARTNERSHIP</div>
                    <div id="an-partnership" style="font-size: 22px; font-weight: 900; font-family: var(--cpl-font-broadcast);">0 (0)</div>
                </div>

                <div class="stat-card-neo" style="background: var(--cpl-panel-dark); padding: 20px; border-radius: 15px; border-bottom: 3px solid var(--cpl-accent-blue); text-align: center;">
                    <div style="font-size: 10px; color: var(--cpl-text-secondary); margin-bottom: 5px; letter-spacing: 1px;">RUN RATE (CRR)</div>
                    <div id="an-crr" style="font-size: 22px; font-weight: 900; font-family: var(--cpl-font-broadcast);">0.00</div>
                </div>

                <div class="stat-card-neo" style="background: var(--cpl-panel-dark); padding: 20px; border-radius: 15px; border-bottom: 3px solid var(--cpl-accent-red); text-align: center;">
                    <div style="font-size: 10px; color: var(--cpl-text-secondary); margin-bottom: 5px; letter-spacing: 1px;">REQ. RATE (RRR)</div>
                    <div id="an-rrr" style="font-size: 22px; font-weight: 900; font-family: var(--cpl-font-broadcast);">0.00</div>
                </div>

                <div class="stat-card-neo" style="background: var(--cpl-panel-dark); padding: 20px; border-radius: 15px; border-bottom: 3px solid var(--cpl-accent-green); text-align: center;">
                    <div style="font-size: 10px; color: var(--cpl-text-secondary); margin-bottom: 5px; letter-spacing: 1px;">PROJECTED SCORE</div>
                    <div id="an-projected" style="font-size: 22px; font-weight: 900; font-family: var(--cpl-font-broadcast);">0</div>
                </div>

            </div>
        </section>

        <aside class="config-sidebar-module">
        <div class="titan-sidebar-engine" style="display: flex; flex-direction: column; gap: 20px;">
            
            <div class="titan-panel-card" style="background: var(--cpl-panel-dark); border-radius: 20px; padding: 25px; border: 1px solid var(--cpl-border-default);">
                <h3 style="font-family: var(--cpl-font-broadcast); font-size: 14px; color: var(--cpl-accent-yellow); margin-bottom: 20px; border-left: 3px solid var(--cpl-accent-yellow); padding-left: 10px;">MATCH CONFIGURATION</h3>
                
                <div class="config-input-group" style="display: flex; flex-direction: column; gap: 12px;">
                    <div class="field-wrapper">
                        <label style="font-size: 10px; color: var(--cpl-text-secondary); text-transform: uppercase; display: block; margin-bottom: 5px;">Tournament Name</label>
                        <input type="text" id="cfg-tournament" value="CHHOTU PREMIER LEAGUE" oninput="globalStateSync()" 
                            style="width: 100%; background: #01040a; border: 1px solid #30363d; padding: 12px; color: #fff; border-radius: 8px; font-family: var(--cpl-font-ui); font-size: 15px;">
                    </div>

                    <div class="field-wrapper">
                        <label style="font-size: 10px; color: var(--cpl-text-secondary); text-transform: uppercase; display: block; margin-bottom: 5px;">Batting Team</label>
                        <input type="text" id="cfg-team-a" value="TEAM A" oninput="globalStateSync()" 
                            style="width: 100%; background: #01040a; border: 1px solid #30363d; padding: 12px; color: var(--cpl-accent-yellow); border-radius: 8px; font-family: var(--cpl-font-broadcast); font-size: 14px;">
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div class="field-wrapper">
                            <label style="font-size: 10px; color: var(--cpl-text-secondary); text-transform: uppercase; display: block; margin-bottom: 5px;">Striker (P1)</label>
                            <input type="text" id="cfg-p1" value="PLAYER 1" oninput="globalStateSync()" 
                                style="width: 100%; background: #01040a; border: 1px solid #30363d; padding: 12px; color: #fff; border-radius: 8px; font-size: 13px;">
                        </div>
                        <div class="field-wrapper">
                            <label style="font-size: 10px; color: var(--cpl-text-secondary); text-transform: uppercase; display: block; margin-bottom: 5px;">Non-Striker (P2)</label>
                            <input type="text" id="cfg-p2" value="PLAYER 2" oninput="globalStateSync()" 
                                style="width: 100%; background: #01040a; border: 1px solid #30363d; padding: 12px; color: #fff; border-radius: 8px; font-size: 13px;">
                        </div>
                    </div>

                    <div class="field-wrapper">
                        <label style="font-size: 10px; color: var(--cpl-text-secondary); text-transform: uppercase; display: block; margin-bottom: 5px;">Current Bowler</label>
                        <input type="text" id="cfg-bowler" value="WAITING" oninput="globalStateSync()" 
                            style="width: 100%; background: #01040a; border: 1px solid #30363d; padding: 12px; color: var(--cpl-accent-blue); border-radius: 8px; font-family: var(--cpl-font-broadcast); font-size: 13px;">
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1.5fr; gap: 10px;">
                        <div class="field-wrapper">
                            <label style="font-size: 10px; color: var(--cpl-text-secondary); text-transform: uppercase; display: block; margin-bottom: 5px;">Target</label>
                            <input type="number" id="cfg-target" value="161" oninput="globalStateSync()" 
                                style="width: 100%; background: #01040a; border: 1px solid #30363d; padding: 12px; color: var(--cpl-accent-yellow); border-radius: 8px; font-weight: 900;">
                        </div>
                        <div class="field-wrapper">
                            <label style="font-size: 10px; color: var(--cpl-text-secondary); text-transform: uppercase; display: block; margin-bottom: 5px;">Opponent Score</label>
                            <input type="text" id="cfg-opp-score" value="160-5 (20.0)" oninput="globalStateSync()" 
                                style="width: 100%; background: #01040a; border: 1px solid #30363d; padding: 12px; color: #fff; border-radius: 8px; font-size: 13px;">
                        </div>
                    </div>

                    <button class="titan-btn" onclick="archiveMatchData()" 
                        style="width: 100%; padding: 15px; background: var(--cpl-accent-blue); color: #000; border: none; border-radius: 8px; font-family: var(--cpl-font-broadcast); font-size: 12px; font-weight: 900; cursor: pointer; margin-top: 10px; transition: var(--cpl-transition-smooth);">
                        SAVE & ARCHIVE MATCH
                    </button>
                </div>
            </div>

            <div class="titan-panel-card" style="background: #000; border-radius: 20px; padding: 20px; border: 1px solid var(--cpl-border-default); flex-grow: 1; display: flex; flex-direction: column;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="font-family: var(--cpl-font-broadcast); font-size: 12px; color: var(--cpl-accent-green);">ACTIVITY MONITOR</h3>
                    <span style="font-family: var(--cpl-font-mono); font-size: 9px; color: var(--cpl-text-secondary);">ID: CPL-2026-TX9</span>
                </div>

                <div id="live-activity-feed" style="flex-grow: 1; overflow-y: auto; height: 300px; padding-right: 10px; font-family: var(--cpl-font-mono); font-size: 11px; line-height: 1.6; color: #8b949e;">
                    <div style="color: var(--cpl-accent-green); margin-bottom: 8px;">[SYSTEM] TITAN Engine Initialized Successfully.</div>
                    <div style="margin-bottom: 8px;">[SYSTEM] Connected to Local Storage.</div>
                    <div style="margin-bottom: 8px;">[AUDIO] Commentary Module Loaded.</div>
                </div>
                
                <div style="margin-top: 15px; border-top: 1px solid #222; padding-top: 10px; font-size: 10px; color: #444; text-align: center;">
                    AUTOMATIC CLOUD SYNC: <span style="color: var(--cpl-accent-green);">ON</span>
                </div>
            </div>
        </div>

    </div> ```
<script>
    /**
     * GLOBAL MATCH STATE OBJECT
     * यह ऑब्जेक्ट मैच की पूरी जानकारी को एक जगह स्टोर करता है।
     */
    let matchState = {
        meta: {
            tournament: "CHHOTU PREMIER LEAGUE",
            battingTeam: "TEAM A",
            bowler: "WAITING",
            target: 161,
            oppScore: "160-5 (20.0)"
        },
        score: {
            runs: 0,
            wickets: 0,
            balls: 0,
            overs: 0,
            extras: 0
        },
        players: {
            p1: { name: "PLAYER 1", runs: 0, balls: 0, onStrike: true },
            p2: { name: "PLAYER 2", runs: 0, balls: 0, onStrike: false }
        },
        partnership: {
            runs: 0,
            balls: 0
        },
        history: [], // Stack for Multi-Level Undo
        config: {
            oversPerMatch: 20,
            autoSwap: true
        }
    };

    /**
     * PRIMARY SCORING FUNCTION
     * @param {number} runs - Runs scored on the ball
     * @param {string} type - Event type (DOT, SINGLE, FOUR, SIX, etc.)
     */
    function processDelivery(runs, type) {
        // Step 1: Commit Current State to History (For Undo)
        commitToHistory();

        // Step 2: Identify Striker
        let striker = matchState.players.p1.onStrike ? matchState.players.p1 : matchState.players.p2;

        // Step 3: Update Striker Stats
        striker.runs += runs;
        striker.balls += 1;

        // Step 4: Update Overall Score
        matchState.score.runs += runs;
        matchState.score.balls += 1;
        matchState.partnership.runs += runs;
        matchState.partnership.balls += 1;

        // Step 5: Handle Logic for Strike Rotation
        if (runs === 1 || runs === 3) {
            rotateStrike();
        }

        // Step 6: Handle Over Completion
        if (matchState.score.balls === 6) {
            matchState.score.overs += 1;
            matchState.score.balls = 0;
            rotateStrike(); // End of over strike change
            logActivity(`OVER COMPLETED: ${matchState.score.overs}`);
        }

        // Step 7: Feedback & Logs
        logActivity(`${type}: ${runs} Run(s) by ${striker.name}`);
        
        // Final: Refresh UI
        refreshTitanUI();
    }

    /**
     * EXTRA DELIVERY ENGINE (Wide, No Ball, Leg Bye)
     */
    function processExtra(type) {
        commitToHistory();
        matchState.score.runs += 1;
        matchState.score.extras += 1;

        if (type === 'LB') {
            matchState.score.balls += 1;
            matchState.partnership.balls += 1;
            if (matchState.score.balls === 6) {
                matchState.score.overs += 1;
                matchState.score.balls = 0;
                rotateStrike();
            }
        }

        logActivity(`EXTRA (${type}): 1 Run added`);
        refreshTitanUI();
    }

    /**
     * DISMISSAL ENGINE (Wicket Management)
     */
    function triggerDismissal() {
        if (matchState.score.wickets >= 10) {
            alert("ALL OUT!");
            return;
        }

        let outPlayer = matchState.players.p1.onStrike ? matchState.players.p1 : matchState.players.p2;
        let newBatsman = prompt(`${outPlayer.name} is OUT. Enter New Batsman:`);
        
        if (newBatsman) {
            commitToHistory();
            matchState.score.wickets += 1;
            
            // Reset Partnership
            matchState.partnership = { runs: 0, balls: 0 };
            
            // Assign New Player
            outPlayer.name = newBatsman.toUpperCase();
            outPlayer.runs = 0;
            outPlayer.balls = 0;

            logActivity(`WICKET: ${outPlayer.name} replaces previous batsman.`);
            refreshTitanUI();
        }
    }

    /**
     * STRIKE ROTATION LOGIC
     */
    function rotateStrike() {
        matchState.players.p1.onStrike = !matchState.players.p1.onStrike;
        matchState.players.p2.onStrike = !matchState.players.p2.onStrike;
    }

    function manualStrikeChange() {
        commitToHistory();
        rotateStrike();
        logActivity("STRIKE SWAPPED MANUALLY");
        refreshTitanUI();
    }

    /**
     * UNDO ENGINE (State Restoration)
     */
    function executeUndo() {
        if (matchState.history.length === 0) {
            alert("HISTORY IS EMPTY");
            return;
        }
        
        let previousState = matchState.history.pop();
        matchState = JSON.parse(previousState);
        
        logActivity("UNDO: REVERTED TO PREVIOUS BALL");
        refreshTitanUI();
    }

    /**
     * DATA PERSISTENCE & CLONE
     */
    function commitToHistory() {
        const snapshot = JSON.stringify(matchState);
        matchState.history.push(snapshot);
        // Limit history to last 50 balls to prevent memory leak
        if (matchState.history.length > 50) matchState.history.shift();
    }

    /**
     * ANALYTICS COMPUTATION ENGINE
     */
    function calculateAnalytics() {
        // CRR Calculation
        let totalBallsPlayed = (matchState.score.overs * 6) + matchState.score.balls;
        let crr = totalBallsPlayed > 0 ? (matchState.score.runs / totalBallsPlayed) * 6 : 0;
        
        // RRR Calculation
        let totalMatchBalls = matchState.config.oversPerMatch * 6;
        let ballsRemaining = totalMatchBalls - totalBallsPlayed;
        let runsNeeded = matchState.meta.target - matchState.score.runs;
        let rrr = ballsRemaining > 0 ? (runsNeeded / ballsRemaining) * 6 : 0;
        
        // Projected Score
        let projected = crr * matchState.config.oversPerMatch;

        return {
            crr: crr.toFixed(2),
            rrr: runsNeeded > 0 ? rrr.toFixed(2) : "0.00",
            proj: Math.round(projected)
        };
    }

    /**
     * ACTIVITY LOGGER
     */
    function logActivity(msg) {
        const feed = document.getElementById('live-activity-feed');
        const timestamp = new Date().toLocaleTimeString();
        const entry = document.createElement('div');
        entry.style.marginBottom = "8px";
        entry.innerHTML = `<span style="color:var(--cpl-accent-yellow)">[${timestamp}]</span> ${msg}`;
        feed.prepend(entry);
    }
</script>
<script>
    /**
     * REFRESH TITAN UI
     * यह फंक्शन पूरे डैशबोर्ड के हर एक एलिमेंट को डेटा के साथ सिंक करता है।
     */
    function refreshTitanUI() {
        // 1. BROADCAST TOP BAR REFRESH
        document.getElementById('ui-score').innerText = `${matchState.score.runs} - ${matchState.score.wickets}`;
        document.getElementById('ui-overs').innerText = `(${matchState.score.overs}.${matchState.score.balls})`;
        document.getElementById('ui-team-a').innerText = matchState.meta.battingTeam;
        
        // 2. PLAYER STATS SYNC
        document.getElementById('ui-p1-name').innerText = matchState.players.p1.name + (matchState.players.p1.onStrike ? " *" : "");
        document.getElementById('ui-p1-stats').innerText = `${matchState.players.p1.runs} (${matchState.players.p1.balls})`;
        
        document.getElementById('ui-p2-name').innerText = matchState.players.p2.name + (matchState.players.p2.onStrike ? " *" : "");
        document.getElementById('ui-p2-stats').innerText = `${matchState.players.p2.runs} (${matchState.players.p2.balls})`;

        // 3. STRIKE HIGHLIGHTER (ANIMATED)
        const p1Row = document.getElementById('ui-p1-row');
        const p2Row = document.getElementById('ui-p2-row');
        
        if (matchState.players.p1.onStrike) {
            p1Row.classList.add('on-strike');
            p2Row.classList.remove('on-strike');
        } else {
            p2Row.classList.add('on-strike');
            p1Row.classList.remove('on-strike');
        }

        // 4. ANALYTICS WIDGETS REFRESH
        const stats = calculateAnalytics();
        document.getElementById('an-partnership').innerText = `${matchState.partnership.runs} (${matchState.partnership.balls})`;
        document.getElementById('an-crr').innerText = stats.crr;
        document.getElementById('an-rrr').innerText = stats.rrr;
        document.getElementById('an-projected').innerText = stats.proj;
        
        // Broadcast Header Analytics
        document.getElementById('projected-score').innerText = stats.proj;
        document.getElementById('ui-target-box').innerText = `TARGET: ${matchState.meta.target}`;
        document.getElementById('ui-opp-sum').innerText = matchState.meta.oppScore;

        // 5. OVER TRACKER (BALL DOTS)
        renderBallDots();

        // 6. BOWLER DISPLAY
        document.getElementById('ui-bowler').innerText = matchState.meta.bowler;

        // 7. AUTO-SAVE TO LOCAL STORAGE
        persistToDisk();
    }

    /**
     * BALL DOTS RENDERER
     * ओवर की गेंदों को ग्राफिकल डॉट्स में बदलता है।
     */
    function renderBallDots() {
        const dotContainer = document.getElementById('ui-ball-dots');
        dotContainer.innerHTML = ''; // Clear previous

        for (let i = 1; i <= 6; i++) {
            const ball = document.createElement('div');
            ball.className = 'ball-unit';
            ball.innerText = i;
            if (i <= matchState.score.balls) {
                ball.classList.add('active-ball');
            }
            dotContainer.appendChild(ball);
        }
    }

    /**
     * GLOBAL STATE SYNC (Input Fields to State)
     * कॉन्फ़िगरेशन पैनल से डेटा को इंजन में भेजता है।
     */
    function globalStateSync() {
        matchState.meta.tournament = document.getElementById('cfg-tournament').value;
        matchState.meta.battingTeam = document.getElementById('cfg-team-a').value;
        matchState.players.p1.name = document.getElementById('cfg-p1').value;
        matchState.players.p2.name = document.getElementById('cfg-p2').value;
        matchState.meta.bowler = document.getElementById('cfg-bowler').value;
        matchState.meta.target = parseInt(document.getElementById('cfg-target').value) || 0;
        matchState.meta.oppScore = document.getElementById('cfg-opp-score').value;

        // Update Top Bar Text immediately
        document.getElementById('ui-tour-display').innerText = matchState.meta.tournament + " | SEASON 2026";
        
        refreshTitanUI();
    }

    /**
     * PERSISTENCE ENGINE
     * मैच का डेटा ब्राउज़र की मेमोरी में सेव करता है।
     */
    function persistToDisk() {
        const dataString = JSON.stringify({
            meta: matchState.meta,
            score: matchState.score,
            players: matchState.players,
            partnership: matchState.partnership
        });
        localStorage.setItem('TITAN_SAVE_DATA', dataString);
    }

    function loadFromDisk() {
        const savedData = localStorage.getItem('TITAN_SAVE_DATA');
        if (savedData) {
            const parsed = JSON.parse(savedData);
            matchState.meta = parsed.meta;
            matchState.score = parsed.score;
            matchState.players = parsed.players;
            matchState.partnership = parsed.partnership;
            
            // Sync Input Fields back
            document.getElementById('cfg-tournament').value = matchState.meta.tournament;
            document.getElementById('cfg-team-a').value = matchState.meta.battingTeam;
            document.getElementById('cfg-p1').value = matchState.players.p1.name;
            document.getElementById('cfg-p2').value = matchState.players.p2.name;
            document.getElementById('cfg-bowler').value = matchState.meta.bowler;
            document.getElementById('cfg-target').value = matchState.meta.target;
            document.getElementById('cfg-opp-score').value = matchState.meta.oppScore;
            
            logActivity("MATCH RESTORED FROM PREVIOUS SESSION");
            refreshTitanUI();
        }
    }

    /**
     * ADVANCED INNINGS SWITCH
     */
    function advancedInningsSwitch() {
        if (confirm("Are you sure you want to Switch Innings? This will set current score as target.")) {
            commitToHistory();
            matchState.meta.target = matchState.score.runs + 1;
            matchState.score = { runs: 0, wickets: 0, balls: 0, overs: 0, extras: 0 };
            matchState.partnership = { runs: 0, balls: 0 };
            matchState.players.p1.runs = 0; matchState.players.p1.balls = 0;
            matchState.players.p2.runs = 0; matchState.players.p2.balls = 0;
            
            document.getElementById('cfg-target').value = matchState.meta.target;
            logActivity("INNINGS SWITCHED: Target set to " + matchState.meta.target);
            refreshTitanUI();
        }
    }

    /**
     * INITIALIZATION
     */
    window.onload = function() {
        loadFromDisk();
        
        // Start Live Clock
        setInterval(() => {
            document.getElementById('ui-clock').innerText = new Date().toLocaleTimeString();
        }, 1000);

        // Final UI Boot
        refreshTitanUI();
        console.log("TITAN V15.0 ENGINE: FULLY ASSEMBLED");
    };

    /**
     * ARCHIVE FUNCTION
     */
    function archiveMatchData() {
        alert("Match Archived Successfully! Data synced to cloud cluster.");
        logActivity("ARCHIVE: Match data saved to permanent record.");
    }

</script>

</body>
</html>
