<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CHHOTU PREMIER LEAGUE | ULTRA-PRO DASHBOARD</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Oswald:wght@300;500;700&family=Rajdhani:wght@300;500;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* LAYER 1: ATOMIC CSS RESET & BROADCAST VARIABLES
           --------------------------------------------------
        */
        :root {
            --primary-yellow: #fec309;
            --secondary-blue: #00e1ff;
            --deep-bg: #010816;
            --panel-dark: #0a1121;
            --input-bg: #050d1a;
            --danger-red: #ff0040;
            --success-green: #00c853;
            --text-white: #ffffff;
            --border-glow: rgba(254, 195, 9, 0.3);
            --broadcast-font: 'Orbitron', sans-serif;
            --ui-font: 'Rajdhani', sans-serif;
            --header-gradient: linear-gradient(90deg, #fec309 0%, #fec309 30%, #000 30.1%, #051124 100%);
        }

        body {
            background-color: var(--deep-bg);
            color: var(--text-white);
            font-family: var(--ui-font);
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(0, 225, 255, 0.05) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(254, 195, 9, 0.05) 0%, transparent 40%);
        }

        /* LAYER 2: PROFESSIONAL SCOREBOARD UI (BAGREKASA STYLE)
           --------------------------------------------------
        */
        .broadcast-overlay {
            width: 100%;
            background: var(--header-gradient);
            height: auto;
            min-height: 120px;
            display: flex;
            align-items: stretch;
            border-bottom: 3px solid #000;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            position: relative;
        }

        .team-box {
            width: 30%;
            display: flex;
            align-items: center;
            padding-left: 20px;
            z-index: 2;
        }

        .team-name-display {
            font-family: var(--broadcast-font);
            font-size: 32px;
            font-weight: 900;
            color: #000;
            text-transform: uppercase;
        }

        .main-score-module {
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: space-around;
            padding: 0 20px;
            background: rgba(5, 17, 36, 0.95);
        }

        .score-huge {
            font-family: var(--broadcast-font);
            font-size: 65px;
            font-weight: 900;
            color: var(--text-white);
            letter-spacing: -2px;
        }

        .overs-sub {
            font-size: 24px;
            color: #888;
            margin-left: 10px;
            font-family: var(--broadcast-font);
        }

        .batsmen-live-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
            min-width: 200px;
        }

        .batsman-entry {
            display: flex;
            justify-content: space-between;
            font-family: var(--broadcast-font);
            font-size: 16px;
            padding: 4px 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 4px;
        }

        .batsman-entry.on-strike {
            border-left: 4px solid var(--primary-yellow);
            background: rgba(254, 195, 9, 0.1);
            color: var(--primary-yellow);
        }

        .opponent-info-box {
            width: 180px;
            background: var(--secondary-blue);
            color: #000;
            padding: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            text-align: right;
            clip-path: polygon(15% 0, 100% 0, 100% 100%, 0 100%);
        }

        /* LAYER 3: SCORING CONTROLLER (ULTRA-PRO DASHBOARD V5)
           --------------------------------------------------
        */
        .admin-wrapper {
            max-width: 1200px;
            margin: 30px auto;
            padding: 20px;
            display: grid;
            grid-template-columns: 1.5fr 1fr;
            gap: 25px;
        }

        .console-card {
            background: var(--panel-dark);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255,255,255,0.05);
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
        }

        .section-title {
            color: var(--primary-yellow);
            font-family: var(--broadcast-font);
            font-size: 14px;
            text-transform: uppercase;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 10px;
            display: flex;
            justify-content: space-between;
        }

        .btn-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }

        .btn-main {
            grid-column: span 4;
            height: 80px;
            background: var(--success-green);
            color: white;
            font-size: 24px;
            font-weight: 900;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: 0.2s;
            text-transform: uppercase;
        }

        .btn-action {
            height: 55px;
            border: none;
            border-radius: 10px;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            color: white;
            transition: 0.2s;
        }

        .btn-run { background: #2563eb; }
        .btn-boundary { background: var(--primary-yellow); color: #000; }
        .btn-wicket { background: var(--danger-red); }
        .btn-util { background: #1e293b; }

        .btn-action:active, .btn-main:active { transform: scale(0.95); opacity: 0.8; }

        /* LAYER 4: SYSTEM CONFIGURATION INPUTS
           --------------------------------------------------
        */
        .config-input-group {
            margin-bottom: 15px;
        }

        .config-input-group label {
            display: block;
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
            text-transform: uppercase;
        }

        .config-input-group input {
            width: 100%;
            background: var(--input-bg);
            border: 1px solid #1e293b;
            padding: 12px;
            border-radius: 8px;
            color: #fff;
            font-family: var(--ui-font);
            font-size: 16px;
        }

        /* LAYER 5: LIVE ANALYTICS WIDGETS
           --------------------------------------------------
        */
        .analytics-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-top: 25px;
        }

        .stat-box {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            border-bottom: 3px solid transparent;
        }

        .stat-val { font-size: 28px; font-weight: 900; font-family: var(--broadcast-font); }
        .stat-lab { font-size: 10px; opacity: 0.5; margin-top: 5px; letter-spacing: 1px; }

        /* LAYER 6: RESPONSIVE ADAPTATION
           --------------------------------------------------
        */
        @media (max-width: 900px) {
            .admin-wrapper { grid-template-columns: 1fr; }
            .broadcast-overlay { flex-direction: column; height: auto; }
            .team-box, .main-score-module, .opponent-info-box { width: 100%; text-align: center; clip-path: none; padding: 15px; }
            .score-huge { font-size: 45px; }
        }

    </style>
</head>
<body onload="initSystem()">

    <div class="broadcast-overlay">
        <div class="team-box">
            <span class="team-name-display" id="ui-team-batting">TEAM A</span>
        </div>

        <div class="main-score-module">
            <div style="display: flex; align-items: baseline;">
                <span class="score-huge" id="ui-main-score">0 - 0</span>
                <span class="overs-sub" id="ui-main-overs">(0.0)</span>
            </div>

            <div class="batsmen-live-info">
                <div class="batsman-entry" id="p1-row">
                    <span id="ui-p1-name">PLAYER 1</span>
                    <span id="ui-p1-runs">0(0)</span>
                </div>
                <div class="batsman-entry" id="p2-row">
                    <span id="ui-p2-name">PLAYER 2</span>
                    <span id="ui-p2-runs">0(0)</span>
                </div>
            </div>
            
            <div style="display: flex; gap: 5px;" id="ui-over-balls">
                </div>
        </div>

        <div class="opponent-info-box">
            <div style="font-size: 10px; font-weight: 900;">OPPONENT INFO</div>
            <div id="ui-opp-summary" style="font-size: 18px; font-weight: 700;">0-0 (0.0)</div>
            <div id="ui-target-display" style="font-size: 14px; font-weight: 900; color: #fff;">TGT: 0</div>
        </div>
    </div>

    <div class="admin-wrapper">
        
        <div class="console-card">
            <div class="section-title">
                <span>SCORING CONTROLLER</span>
                <span id="ui-auto-strike-status" style="color: var(--secondary-blue);">AUTO STRIKE: ON</span>
            </div>

            <div class="btn-grid">
                <button class="btn-main" onclick="addBall(0)">NEXT BALL (DOT)</button>
                
                <button class="btn-action btn-run" onclick="addBall(1)">+1 RUN</button>
                <button class="btn-action btn-run" onclick="addBall(2)">+2 RUNS</button>
                <button class="btn-action btn-run" onclick="addBall(3)">+3 RUNS</button>
                <button class="btn-action btn-wicket" style="background: #b91c1c;" onclick="undoLast()">-1 ERASE</button>

                <button class="btn-action btn-boundary" onclick="addBall(4)">FOUR (4)</button>
                <button class="btn-action btn-boundary" onclick="addBall(6)">SIX (6)</button>
                <button class="btn-action btn-wicket" onclick="handleWicket()">WICKET (OUT)</button>
                <button class="btn-action btn-util" onclick="swapStrike()">SWAP</button>

                <button class="btn-action btn-util" onclick="addExtra('WD')">WD</button>
                <button class="btn-action btn-util" onclick="addExtra('NB')">NB</button>
                <button class="btn-action btn-util" onclick="addExtra('LB')">LB</button>
                <button class="btn-action btn-util" onclick="undoLast()">UNDO</button>
                
                <button class="btn-main" style="background: var(--secondary-blue); color: #000; height: 50px; font-size: 14px;" onclick="archiveMatch()">SAVE & ARCHIVE MATCH</button>
                <button class="btn-main" style="background: var(--danger-red); height: 50px; font-size: 14px;" onclick="fullReset()">RESET ALL</button>
            </div>

            <div class="analytics-row">
                <div class="stat-box" style="border-color: var(--primary-yellow);">
                    <div class="stat-val" id="stat-partnership">0</div>
                    <div class="stat-lab">PARTNERSHIP</div>
                </div>
                <div class="stat-box" style="border-color: var(--secondary-blue);">
                    <div class="stat-val" id="stat-crr">0.0</div>
                    <div class="stat-lab">RUN RATE (CRR)</div>
                </div>
                <div class="stat-box" style="border-color: var(--danger-red);">
                    <div class="stat-val" id="stat-rrr">0.0</div>
                    <div class="stat-lab">REQ. RATE (RRR)</div>
                </div>
                <div class="stat-box" style="border-color: var(--success-green);">
                    <div class="stat-val" id="stat-extras">0</div>
                    <div class="stat-lab">EXTRAS</div>
                </div>
            </div>
        </div>

        <div class="console-card">
            <div class="section-title">SYSTEM CONFIGURATION</div>
            
            <div class="config-input-group">
                <label>Tournament Name</label>
                <input type="text" id="cfg-tour" placeholder="CHHOTU PREMIER LEAGUE" oninput="syncConfig()">
            </div>
            <div class="config-input-group">
                <label>Batting Team</label>
                <input type="text" id="cfg-team-a" placeholder="TEAM A" oninput="syncConfig()">
            </div>
            <div class="config-input-group">
                <label>Striker (Player 1)</label>
                <input type="text" id="cfg-p1" placeholder="PLAYER 1" oninput="syncConfig()">
            </div>
            <div class="config-input-group">
                <label>Non-Striker (Player 2)</label>
                <input type="text" id="cfg-p2" placeholder="PLAYER 2" oninput="syncConfig()">
            </div>
            <div class="config-input-group">
                <label>Current Bowler</label>
                <input type="text" id="cfg-bowler" placeholder="BOWLER NAME" oninput="syncConfig()">
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1.5fr; gap: 10px;">
                <div class="config-input-group">
                    <label>Target</label>
                    <input type="number" id="cfg-target" placeholder="161" oninput="syncConfig()">
                </div>
                <div class="config-input-group">
                    <label>Opponent Summary</label>
                    <input type="text" id="cfg-opp-sum" placeholder="160-5 (6.2)" oninput="syncConfig()">
                </div>
            </div>
            
            <button class="btn-main" style="height: 50px; background: #1e293b; font-size: 14px; margin-top: 10px;" onclick="switchInnings()">SWITCH INNINGS</button>
        </div>

    </div>

    <div class="admin-wrapper" style="margin-top: 0;">
        <div class="console-card" style="grid-column: span 2;">
            <div class="section-title">MATCH ARCHIVES (HISTORY)</div>
            <div id="match-logs" style="max-height: 200px; overflow-y: auto; font-family: 'Roboto Mono'; font-size: 12px; opacity: 0.7;">
                [SYSTEM]: Engine Initialized... Ready for Match.
            </div>
        </div>
    </div>

    <script>
        /* LAYER 7: TITAN ENGINE JAVASCRIPT LOGIC
           --------------------------------------------------
        */

        // 1. Database Initialization
        const firebaseConfig = { databaseURL: "https://myscoreboard-b140f-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database().ref("chhotu_cpl_titan_v10");

        // 2. Comprehensive State Management
        let state = {
            score: 0, wkts: 0, balls: 0, overs: 0,
            target: 0, extras: 0,
            p1: { name: "PLAYER 1", runs: 0, balls: 0 },
            p2: { name: "PLAYER 2", runs: 0, balls: 0 },
            strike: 1, // 1 for p1, 2 for p2
            config: { tour: "", teamA: "", oppSum: "", bowler: "" },
            history: [],
            partnership: { runs: 0, balls: 0 }
        };

        // 3. Core Engine Functions
        function initSystem() {
            db.on('value', (snap) => {
                const data = snap.val();
                if(data) {
                    state = data;
                    renderUI();
                }
            });
        }

        function addBall(runs) {
            saveHistory();
            state.score += runs;
            state.partnership.runs += runs;
            state.partnership.balls += 1;

            if(state.strike === 1) {
                state.p1.runs += runs;
                state.p1.balls += 1;
            } else {
                state.p2.runs += runs;
                state.p2.balls += 1;
            }

            state.balls += 1;
            if(state.balls >= 6) {
                state.overs += 1;
                state.balls = 0;
                swapStrike();
            }

            if(runs === 1 || runs === 3) swapStrike();
            pushData();
            logEvent(`Ball: ${runs} runs added.`);
        }

        function addExtra(type) {
            saveHistory();
            state.score += 1;
            state.extras += 1;
            if(type === 'LB') {
                state.balls += 1;
                if(state.balls >= 6) { state.overs += 1; state.balls = 0; swapStrike(); }
            }
            pushData();
            logEvent(`Extra: ${type} awarded.`);
        }

        function handleWicket() {
            const nextMan = prompt("ENTER NEW BATSMAN NAME:");
            if(!nextMan) return;

            saveHistory();
            state.wkts += 1;
            state.partnership = { runs: 0, balls: 0 };

            if(state.strike === 1) {
                state.p1 = { name: nextMan.toUpperCase(), runs: 0, balls: 0 };
            } else {
                state.p2 = { name: nextMan.toUpperCase(), runs: 0, balls: 0 };
            }
            pushData();
            logEvent(`WICKET! ${nextMan} is in.`);
        }

        function swapStrike() {
            state.strike = state.strike === 1 ? 2 : 1;
            pushData();
        }

        // 4. Synchronization Logic
        function syncConfig() {
            state.config.tour = document.getElementById('cfg-tour').value;
            state.config.teamA = document.getElementById('cfg-team-a').value;
            state.p1.name = document.getElementById('cfg-p1').value;
            state.p2.name = document.getElementById('cfg-p2').value;
            state.config.bowler = document.getElementById('cfg-bowler').value;
            state.target = parseInt(document.getElementById('cfg-target').value) || 0;
            state.config.oppSum = document.getElementById('cfg-opp-sum').value;
            pushData();
        }

        function pushData() {
            db.set(state);
        }

        // 5. Rendering Engine
        function renderUI() {
            // Header Stats
            document.getElementById('ui-team-batting').innerText = state.config.teamA || "TEAM A";
            document.getElementById('ui-main-score').innerText = `${state.score} - ${state.wkts}`;
            document.getElementById('ui-main-overs').innerText = `(${state.overs}.${state.balls})`;
            
            // Batsmen
            document.getElementById('ui-p1-name').innerText = state.p1.name;
            document.getElementById('ui-p1-runs').innerText = `${state.p1.runs}(${state.p1.balls})`;
            document.getElementById('p1-row').className = state.strike === 1 ? "batsman-entry on-strike" : "batsman-entry";

            document.getElementById('ui-p2-name').innerText = state.p2.name;
            document.getElementById('ui-p2-runs').innerText = `${state.p2.runs}(${state.p2.balls})`;
            document.getElementById('p2-row').className = state.strike === 2 ? "batsman-entry on-strike" : "batsman-entry";

            // Opponent & Analytics
            document.getElementById('ui-opp-summary').innerText = state.config.oppSum || "0-0 (0.0)";
            document.getElementById('ui-target-display').innerText = `TGT: ${state.target}`;
            
            let totalBalls = (state.overs * 6) + state.balls;
            let crr = totalBalls > 0 ? (state.score / totalBalls) * 6 : 0;
            document.getElementById('stat-crr').innerText = crr.toFixed(2);
            document.getElementById('stat-partnership').innerText = `${state.partnership.runs} (${state.partnership.balls})`;
            document.getElementById('stat-extras').innerText = state.extras;

            if(state.target > 0) {
                let remRuns = state.target - state.score;
                let remBalls = 120 - totalBalls; // Assuming 20 over match
                let rrr = remBalls > 0 ? (remRuns / remBalls) * 6 : 0;
                document.getElementById('stat-rrr').innerText = rrr.toFixed(2);
            }

            // Sync Admin Inputs
            document.getElementById('cfg-tour').value = state.config.tour;
            document.getElementById('cfg-team-a').value = state.config.teamA;
            document.getElementById('cfg-p1').value = state.p1.name;
            document.getElementById('cfg-p2').value = state.p2.name;
            document.getElementById('cfg-bowler').value = state.config.bowler;
            document.getElementById('cfg-target').value = state.target;
            document.getElementById('cfg-opp-sum').value = state.config.oppSum;

            // Render Over Dots
            let dots = "";
            for(let i=1; i<=6; i++) {
                let color = i <= state.balls ? 'var(--primary-yellow)' : '#333';
                dots += `<div style="width:12px; height:12px; background:${color}; border-radius:50%;"></div>`;
            }
            document.getElementById('ui-over-balls').innerHTML = dots;
        }

        // 6. Utility Functions
        function saveHistory() {
            if(!state.history) state.history = [];
            state.history.push(JSON.stringify(state));
            if(state.history.length > 50) state.history.shift();
        }

        function undoLast() {
            if(state.history && state.history.length > 0) {
                state = JSON.parse(state.history.pop());
                pushData();
                logEvent("System: Last action undone.");
            }
        }

        function logEvent(msg) {
            const logBox = document.getElementById('match-logs');
            const time = new Date().toLocaleTimeString();
            logBox.innerHTML = `<div>[${time}] ${msg}</div>` + logBox.innerHTML;
        }

        function fullReset() {
            if(confirm("THIS WILL ERASE EVERYTHING. PROCEED?")) {
                db.set({
                    score: 0, wkts: 0, balls: 0, overs: 0,
                    target: 0, extras: 0,
                    p1: { name: "PLAYER 1", runs: 0, balls: 0 },
                    p2: { name: "PLAYER 2", runs: 0, balls: 0 },
                    strike: 1, config: { tour: "", teamA: "", oppSum: "", bowler: "" },
                    history: [], partnership: { runs: 0, balls: 0 }
                });
            }
        }

        function switchInnings() {
            // Automated Inning Swap Logic
            const tempOpp = state.config.oppSum;
            state.config.oppSum = `${state.score}-${state.wkts} (${state.overs}.${state.balls})`;
            state.target = state.score + 1;
            state.score = 0; state.wkts = 0; state.balls = 0; state.overs = 0;
            state.p1 = { name: "BATSMAN 1", runs: 0, balls: 0 };
            state.p2 = { name: "BATSMAN 2", runs: 0, balls: 0 };
            pushData();
            alert("INNINGS SWITCHED! TARGET UPDATED.");
        }

    </script>
</body>
</html>
